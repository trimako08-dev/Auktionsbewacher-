<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auktions-Bot Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .status-online { animation: pulse 2s infinite; }
        .countdown-timer { 
            font-family: 'Courier New', monospace; 
            font-size: 2rem; 
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .search-progress {
            animation: searchPulse 1.5s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes searchPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .error-flash {
            animation: errorFlash 0.5s ease-in-out 3;
        }
        @keyframes errorFlash {
            0%, 100% { background-color: rgb(239 68 68); }
            50% { background-color: rgb(185 28 28); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h2 class="text-2xl font-bold mb-6 text-center">üîê Zugang erforderlich</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Passwort</label>
                    <input type="password" id="passwordInput" class="w-full border rounded px-3 py-2" placeholder="Passwort eingeben">
                </div>
                <button onclick="checkPassword()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                    Anmelden
                </button>
                <p id="errorMsg" class="text-red-600 text-sm text-center hidden">Falsches Passwort!</p>
            </div>
        </div>
    </div>

    <!-- Header -->
    <div class="gradient-bg text-white py-6">
        <div class="container mx-auto px-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold">ü§ñ Auktions-Bot Dashboard</h1>
                    <p class="text-blue-100 mt-2">Automatische √úberwachung mit Live-Timer & Fehler√ºberwachung</p>
                </div>
                <div class="text-right">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-400 rounded-full status-online" id="botStatusIndicator"></div>
                        <span class="text-sm" id="botStatusText">Bot Status: Online</span>
                    </div>
                    <div class="text-sm text-blue-100 mt-1" id="lastCheckTime">Letzte Pr√ºfung: vor 2 Min.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-6 py-8">
        <!-- Live Search Timer -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-6 mb-8 card-shadow">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold mb-2 flex items-center">
                        <span class="text-3xl mr-3">‚è∞</span>
                        N√§chste Produktsuche in:
                    </h2>
                    <div class="countdown-timer text-yellow-300" id="countdownTimer">05:00</div>
                    <p class="text-blue-100 mt-2" id="searchStatus">üîç Bereit f√ºr n√§chste Suche...</p>
                    <div class="mt-3 bg-white bg-opacity-20 rounded-lg p-3">
                        <div class="text-sm text-blue-100 mb-1">N√§chstes Deep Scraping in:</div>
                        <div class="text-lg font-bold text-yellow-300" id="deepScrapingCountdown">15:00</div>
                        <div class="text-xs text-blue-200">Alle 15 Minuten - Detaillierte Verf√ºgbarkeitspr√ºfung</div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="bg-white bg-opacity-20 rounded-lg p-4">
                        <div class="text-sm text-blue-100">Suchintervall:</div>
                        <div class="text-xl font-bold">5 Minuten</div>
                        <div class="text-xs text-blue-200 mt-1">Automatisch</div>
                    </div>
                </div>
            </div>
            
            <!-- Search Progress Bar -->
            <div class="mt-4">
                <div class="bg-white bg-opacity-20 rounded-full h-2">
                    <div class="bg-yellow-400 h-2 rounded-full transition-all duration-1000" id="searchProgress" style="width: 0%"></div>
                </div>
                <div class="flex justify-between text-xs text-blue-200 mt-1">
                    <span>Letzte Suche</span>
                    <span id="nextSearchTime">N√§chste Suche um 14:35</span>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg p-6 card-shadow">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <span class="text-2xl">üëÄ</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600 text-sm">Heute gefunden</p>
                        <p class="text-2xl font-bold text-gray-900" id="todayFoundCount">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg p-6 card-shadow">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <span class="text-2xl">‚úÖ</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600 text-sm">Angenommen (Telegram + App)</p>
                        <p class="text-2xl font-bold text-gray-900" id="acceptedCount">23</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg p-6 card-shadow">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                        <span class="text-2xl">‚ùå</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600 text-sm">Abgelehnt (Telegram + App)</p>
                        <p class="text-2xl font-bold text-gray-900" id="rejectedCount">12</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg p-6 card-shadow">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                        <span class="text-2xl">üîç</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600 text-sm">Letzte Suche</p>
                        <p class="text-sm font-bold text-gray-900" id="lastSearchResult">3 Produkte</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column -->
            <div class="lg:col-span-2 space-y-6">
                <!-- System Health Monitor -->
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <span class="text-2xl mr-2">üè•</span>
                        System-Gesundheit & Fehler√ºberwachung
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-400" id="telegramHealth">
                            <h3 class="font-medium text-green-800 flex items-center">
                                <span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                                üì± Telegram Bot
                            </h3>
                            <p class="text-sm text-green-600 mt-1">Verbindung stabil ‚Ä¢ Letzte Nachricht: vor 30s</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-400" id="webAppHealth">
                            <h3 class="font-medium text-green-800 flex items-center">
                                <span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                                üíª Web-App
                            </h3>
                            <p class="text-sm text-green-600 mt-1">Online ‚Ä¢ Alle Funktionen verf√ºgbar</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-400" id="sheetsHealth">
                            <h3 class="font-medium text-green-800 flex items-center">
                                <span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                                üìä Google Sheets
                            </h3>
                            <p class="text-sm text-green-600 mt-1">Sync aktiv ‚Ä¢ Letzte √úbertragung: vor 1m</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-400" id="searchHealth">
                            <h3 class="font-medium text-green-800 flex items-center">
                                <span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                                üîç Produktsuche
                            </h3>
                            <p class="text-sm text-green-600 mt-1">L√§uft automatisch ‚Ä¢ N√§chste Suche in 4:23</p>
                        </div>
                    </div>
                    
                    <!-- Error Log -->
                    <div class="mt-4 bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-medium mb-2 flex items-center">
                            <span class="text-lg mr-2">üìã</span>
                            Fehlerprotokoll (Letzte 24h)
                        </h3>
                        <div id="errorLog" class="text-sm text-gray-600 space-y-1 max-h-32 overflow-y-auto">
                            <p class="text-green-600">‚úÖ Keine Fehler in den letzten 24 Stunden</p>
                        </div>
                    </div>
                </div>

                <!-- Live Product Feed -->
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <span class="text-2xl mr-2">üî¥</span>
                        Live Produktfeed
                        <span class="ml-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs animate-pulse">LIVE</span>
                    </h2>
                    
                    <!-- Search Status -->
                    <div class="bg-blue-50 p-4 rounded-lg mb-4 border-l-4 border-blue-400">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-medium text-blue-800" id="currentSearchStatus">üîç Bereit f√ºr n√§chste Suche</h3>
                                <p class="text-sm text-blue-600 mt-1" id="searchDetails">Automatische Suche alle 5 Minuten aktiv</p>
                            </div>
                            <button onclick="startManualSearch()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm">
                                üîç Jetzt suchen
                            </button>
                        </div>
                    </div>
                    
                    <!-- Products List -->
                    <div class="space-y-4" id="liveProductsList">
                        <div class="text-center text-gray-500 py-8">
                            <span class="text-4xl mb-2 block">‚è≥</span>
                            <p>Warten auf n√§chste Produktsuche...</p>
                            <p class="text-sm mt-1">N√§chste automatische Suche in <span id="nextSearchCountdown">4:23</span></p>
                        </div>
                    </div>
                </div>

                <!-- Current Products with Dual Control -->
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <span class="text-2xl mr-2">üéØ</span>
                        Gefundene Produkte (Telegram + Web-App Steuerung)
                    </h2>
                    
                    <!-- Sample Products -->
                    <div class="space-y-4" id="productsList">
                        <!-- Products will be populated by search -->
                        <div class="text-center text-gray-400 py-8">
                            <span class="text-4xl mb-2 block">üì¶</span>
                            <p>Noch keine Produkte gefunden</p>
                            <p class="text-sm mt-1">Produkte erscheinen hier automatisch bei der n√§chsten Suche</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="space-y-6">
                <!-- Search Configuration -->
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <span class="text-2xl mr-2">‚öôÔ∏è</span>
                        Such-Konfiguration
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Suchintervall (Minuten)</label>
                            <select id="searchInterval" onchange="updateSearchInterval()" class="w-full border rounded px-3 py-2">
                                <option value="1">1 Minute (Test)</option>
                                <option value="2">2 Minuten</option>
                                <option value="5" selected>5 Minuten</option>
                                <option value="10">10 Minuten</option>
                                <option value="15">15 Minuten</option>
                                <option value="30">30 Minuten</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Mindestgewinn (‚Ç¨)</label>
                            <input type="number" id="minProfit" value="50" class="w-full border rounded px-3 py-2">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Mindestgewinn (%)</label>
                            <input type="number" id="minProfitPercent" value="30" class="w-full border rounded px-3 py-2">
                        </div>
                        
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" id="autoNotify" checked class="rounded">
                            <label for="autoNotify" class="text-sm">Telegram-Benachrichtigungen</label>
                        </div>
                        
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" id="errorNotify" checked class="rounded">
                            <label for="errorNotify" class="text-sm">Fehler-Benachrichtigungen</label>
                        </div>
                        
                        <button onclick="saveSearchConfig()" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">
                            üíæ Konfiguration speichern
                        </button>
                    </div>
                </div>

                <!-- Telegram Bot Configuration -->
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <span class="text-2xl mr-2">ü§ñ</span>
                        Telegram Bot Konfiguration
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Bot Token</label>
                            <input type="password" id="botToken" value="8277266559:AAEEh6xJ8H40wQx-E-XpjBOOfEljWchW96A" class="w-full border rounded px-3 py-2 text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Chat ID</label>
                            <input type="text" id="chatId" value="6365557456" class="w-full border rounded px-3 py-2 text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Webhook URL</label>
                            <input type="text" id="webhookUrl" value="https://your-app.herokuapp.com/webhook" class="w-full border rounded px-3 py-2 text-sm">
                            <p class="text-xs text-gray-500 mt-1">F√ºr Telegram Inline Button Antworten</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <input type="checkbox" id="inlineButtons" checked class="rounded">
                            <label for="inlineButtons" class="text-sm">Inline Buttons aktivieren</label>
                        </div>
                        <div class="bg-yellow-50 border border-yellow-200 rounded p-3 text-sm">
                            <p class="text-yellow-800 font-medium">‚ö†Ô∏è Button-Probleme?</p>
                            <p class="text-yellow-700 mt-1">Falls Telegram Buttons nicht funktionieren, deaktivieren Sie diese Option. Alle Entscheidungen k√∂nnen dann √ºber die Web-App getroffen werden.</p>
                        </div>
                        <button onclick="setupTelegramWebhook()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition-colors">
                            Webhook einrichten
                        </button>
                        <button onclick="sendTestMessageWithButtons()" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition-colors">
                            Test mit Buttons senden
                        </button>
                        <button onclick="enableEmergencyMode()" class="w-full bg-orange-600 text-white py-2 rounded hover:bg-orange-700 transition-colors">
                            üö® Notfall-Modus (Nur Web-App)
                        </button>
                    </div>
                </div>

                <!-- Google Sheets Integration -->
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <span class="text-2xl mr-2">üìä</span>
                        Google Sheets Integration
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Spreadsheet ID</label>
                            <input type="text" id="spreadsheetId" value="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms" class="w-full border rounded px-3 py-2 text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">API Key</label>
                            <input type="password" id="sheetsApiKey" value="YOUR_GOOGLE_SHEETS_API_KEY" class="w-full border rounded px-3 py-2 text-sm">
                        </div>
                        
                        <!-- Live Google Sheets Link -->
                        <div id="googleSheetsLink">
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <h3 class="font-bold text-gray-800 mb-2">üìä Google Sheets - Bereit</h3>
                                <p class="text-sm text-gray-600 mb-3">Noch keine Daten synchronisiert</p>
                                <a href="https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit#gid=0" 
                                   target="_blank" 
                                   class="inline-block bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition-colors">
                                    üìä Google Sheets √∂ffnen
                                </a>
                            </div>
                        </div>
                        
                        <!-- Sheets Structure Preview -->
                        <div class="bg-gray-50 p-3 rounded text-xs">
                            <p class="font-medium mb-2">üìã Spalten-Struktur:</p>
                            <div class="grid grid-cols-1 gap-1">
                                <p><strong>A-P:</strong> Angenommene Produkte (ID, Name, Preis, Gewinn, Quelle, etc.)</p>
                                <p><strong>Q-AF:</strong> Abgelehnte Produkte (ID, Name, Grund, Versuche, etc.)</p>
                                <p><strong>Farben:</strong> Gr√ºn=Angenommen, Rot=Abgelehnt, Blau=Telegram, Lila=Web-App</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="openGoogleSheets()" class="bg-purple-600 text-white py-2 px-3 rounded text-sm hover:bg-purple-700">
                                üìä Sheets √∂ffnen
                            </button>
                            <button onclick="syncAllToSheets()" class="bg-blue-600 text-white py-2 px-3 rounded text-sm hover:bg-blue-700">
                                üîÑ Alles syncen
                            </button>
                        </div>
                        
                        <div class="bg-green-50 p-3 rounded border-l-4 border-green-400">
                            <p class="text-sm text-green-800 font-medium">‚úÖ Auto-Sync Aktiv</p>
                            <p class="text-xs text-green-600 mt-1">Alle Telegram & Web-App Entscheidungen werden automatisch zu Google Sheets √ºbertragen</p>
                        </div>
                    </div>
                </div>

                <!-- Decision Statistics -->
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <span class="text-2xl mr-2">üìà</span>
                        Entscheidungs-Statistiken
                    </h2>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-blue-50 p-3 rounded text-center">
                                <div class="text-2xl font-bold text-blue-600" id="telegramDecisions">0</div>
                                <div class="text-xs text-blue-600">üì± Telegram</div>
                            </div>
                            <div class="bg-purple-50 p-3 rounded text-center">
                                <div class="text-2xl font-bold text-purple-600" id="webAppDecisions">0</div>
                                <div class="text-xs text-purple-600">üíª Web-App</div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-green-50 p-3 rounded text-center">
                                <div class="text-2xl font-bold text-green-600" id="totalAccepted">0</div>
                                <div class="text-xs text-green-600">‚úÖ Angenommen</div>
                            </div>
                            <div class="bg-red-50 p-3 rounded text-center">
                                <div class="text-2xl font-bold text-red-600" id="totalRejected">0</div>
                                <div class="text-xs text-red-600">‚ùå Abgelehnt</div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 p-3 rounded">
                            <p class="text-sm font-medium mb-2">üìä Letzte Aktivit√§ten:</p>
                            <div id="recentActivities" class="text-xs text-gray-600 space-y-1">
                                <p>Keine Aktivit√§ten bisher...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const BOT_TOKEN = "8277266559:AAEEh6xJ8H40wQx-E-XpjBOOfEljWchW96A";
        const CHAT_ID = "6365557456";
        const PASSWORD = "auktion2024";
        const WEBHOOK_URL = "https://your-app.herokuapp.com/webhook";
        
        // Search Configuration
        let SEARCH_CONFIG = {
            interval: 5, // minutes
            minProfit: 50,
            minProfitPercent: 30,
            autoNotify: true,
            errorNotify: true
        };
        
        // Global timers and intervals
        let searchTimer = null;
        let countdownTimer = null;
        let deepScrapingTimer = null;
        let deepScrapingCountdownTimer = null;
        let healthCheckTimer = null;
        let nextSearchTime = null;
        let nextDeepScrapingTime = null;
        
        // System Health Monitor
        const HEALTH_MONITOR = {
            telegram: { status: 'online', lastCheck: Date.now(), errors: 0 },
            webapp: { status: 'online', lastCheck: Date.now(), errors: 0 },
            sheets: { status: 'online', lastCheck: Date.now(), errors: 0 },
            search: { status: 'online', lastCheck: Date.now(), errors: 0 }
        };
        
        // Error logging system
        const ERROR_LOGGER = {
            errors: [],
            
            logError: function(component, message, severity = 'warning') {
                const error = {
                    id: Date.now(),
                    component: component,
                    message: message,
                    severity: severity, // 'info', 'warning', 'error', 'critical'
                    timestamp: new Date().toISOString()
                };
                
                this.errors.unshift(error);
                
                // Keep only last 50 errors
                if (this.errors.length > 50) {
                    this.errors = this.errors.slice(0, 50);
                }
                
                // Update UI
                this.updateErrorLog();
                
                // Send to Telegram if enabled and severity is warning or higher
                if (SEARCH_CONFIG.errorNotify && ['warning', 'error', 'critical'].includes(severity)) {
                    this.sendErrorToTelegram(error);
                }
                
                // Update health status
                this.updateHealthStatus(component, severity);
                
                console.error(`[${component.toUpperCase()}] ${message}`, error);
            },
            
            updateErrorLog: function() {
                const errorLogElement = document.getElementById('errorLog');
                if (!errorLogElement) return;
                
                if (this.errors.length === 0) {
                    errorLogElement.innerHTML = '<p class="text-green-600">‚úÖ Keine Fehler in den letzten 24 Stunden</p>';
                    return;
                }
                
                const last24h = this.errors.filter(error => 
                    Date.now() - new Date(error.timestamp).getTime() < 24 * 60 * 60 * 1000
                );
                
                if (last24h.length === 0) {
                    errorLogElement.innerHTML = '<p class="text-green-600">‚úÖ Keine Fehler in den letzten 24 Stunden</p>';
                    return;
                }
                
                errorLogElement.innerHTML = last24h.slice(0, 10).map(error => {
                    const severityColors = {
                        info: 'text-blue-600',
                        warning: 'text-yellow-600',
                        error: 'text-red-600',
                        critical: 'text-red-800 font-bold'
                    };
                    
                    const severityIcons = {
                        info: '‚ÑπÔ∏è',
                        warning: '‚ö†Ô∏è',
                        error: '‚ùå',
                        critical: 'üö®'
                    };
                    
                    const time = new Date(error.timestamp).toLocaleTimeString('de-DE');
                    return `<p class="${severityColors[error.severity]}">${severityIcons[error.severity]} ${time} - ${error.component.toUpperCase()}: ${error.message}</p>`;
                }).join('');
            },
            
            sendErrorToTelegram: function(error) {
                const severityIcons = {
                    warning: '‚ö†Ô∏è',
                    error: '‚ùå',
                    critical: 'üö®'
                };
                
                const message = `${severityIcons[error.severity]} <b>SYSTEM-FEHLER</b>\n\n` +
                              `üîß Komponente: ${error.component.toUpperCase()}\n` +
                              `üìù Fehler: ${error.message}\n` +
                              `‚ö° Schweregrad: ${error.severity.toUpperCase()}\n` +
                              `‚è∞ Zeit: ${new Date(error.timestamp).toLocaleString('de-DE')}\n\n` +
                              `üîÑ System versucht automatische Wiederherstellung...`;
                
                sendTelegramMessage(message);
            },
            
            updateHealthStatus: function(component, severity) {
                if (HEALTH_MONITOR[component]) {
                    HEALTH_MONITOR[component].errors++;
                    HEALTH_MONITOR[component].lastCheck = Date.now();
                    
                    if (severity === 'critical') {
                        HEALTH_MONITOR[component].status = 'critical';
                    } else if (severity === 'error' && HEALTH_MONITOR[component].status !== 'critical') {
                        HEALTH_MONITOR[component].status = 'error';
                    } else if (severity === 'warning' && HEALTH_MONITOR[component].status === 'online') {
                        HEALTH_MONITOR[component].status = 'warning';
                    }
                    
                    this.updateHealthUI();
                }
            },
            
            updateHealthUI: function() {
                const components = ['telegram', 'webapp', 'sheets', 'search'];
                
                components.forEach(component => {
                    const element = document.getElementById(`${component}Health`);
                    if (!element) return;
                    
                    const health = HEALTH_MONITOR[component];
                    const statusIndicator = element.querySelector('.w-3.h-3');
                    const statusText = element.querySelector('h3');
                    const statusDetail = element.querySelector('p');
                    
                    // Update colors and status based on health
                    let bgColor, borderColor, textColor, statusColor, statusMessage;
                    
                    switch (health.status) {
                        case 'critical':
                            bgColor = 'bg-red-50';
                            borderColor = 'border-red-400';
                            textColor = 'text-red-800';
                            statusColor = 'bg-red-500';
                            statusMessage = 'KRITISCHER FEHLER';
                            element.classList.add('error-flash');
                            break;
                        case 'error':
                            bgColor = 'bg-red-50';
                            borderColor = 'border-red-400';
                            textColor = 'text-red-800';
                            statusColor = 'bg-red-500';
                            statusMessage = 'FEHLER';
                            break;
                        case 'warning':
                            bgColor = 'bg-yellow-50';
                            borderColor = 'border-yellow-400';
                            textColor = 'text-yellow-800';
                            statusColor = 'bg-yellow-500';
                            statusMessage = 'WARNUNG';
                            break;
                        default:
                            bgColor = 'bg-green-50';
                            borderColor = 'border-green-400';
                            textColor = 'text-green-800';
                            statusColor = 'bg-green-500';
                            statusMessage = 'ONLINE';
                    }
                    
                    // Update element classes
                    element.className = `${bgColor} p-4 rounded-lg border-l-4 ${borderColor}`;
                    statusIndicator.className = `w-3 h-3 ${statusColor} rounded-full mr-2`;
                    statusText.className = `font-medium ${textColor} flex items-center`;
                    
                    // Update status detail
                    const lastCheckTime = Math.floor((Date.now() - health.lastCheck) / 1000);
                    const timeText = lastCheckTime < 60 ? `vor ${lastCheckTime}s` : `vor ${Math.floor(lastCheckTime / 60)}m`;
                    
                    statusDetail.className = `text-sm ${textColor.replace('800', '600')} mt-1`;
                    statusDetail.textContent = `${statusMessage} ‚Ä¢ Letzte Pr√ºfung: ${timeText} ‚Ä¢ Fehler: ${health.errors}`;
                });
            }
        };
        
        // Automatic Product Search System
        const PRODUCT_SEARCH_SYSTEM = {
            isSearching: false,
            searchCount: 0,
            foundToday: 0,
            
            // Sample product database for simulation - budget-friendly with jewelry focus
            sampleProducts: [
                // Budget-friendly Zoll-Auktion Products (‚Ç¨15-70)
                {
                    name: "Silberring 925 - Vintage Design",
                    price: 15,
                    marketValue: 45,
                    image: "https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=80&h=80&fit=crop&crop=center",
                    location: "D√ºsseldorf",
                    endTime: "45min",
                    website: "zoll-auktion.de",
                    auctionType: "Zoll-Auktion",
                    link: "https://www.zoll-auktion.de/auktion/suche.php?id=789456&kategorie=schmuck&standort=duesseldorf",
                    condition: "Sehr gut",
                    reason: "Zollbeschlagnahme",
                    description: "Zollbeschlagnahme, 925er Silber, vintage Design, keine Kratzer, authentifiziert",
                    features: "925er Sterlingsilber, Vintage-Design, Gr√∂√üe 18, handgefertigt, antik",
                    shipping: "Versand m√∂glich (+‚Ç¨4,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                {
                    name: "Goldkette 14k - 50cm Panzerkette",
                    price: 45,
                    marketValue: 120,
                    image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=80&h=80&fit=crop&crop=center",
                    location: "Hamburg",
                    endTime: "1h 23min",
                    website: "zoll-auktion.de",
                    auctionType: "Zoll-Auktion",
                    link: "https://www.zoll-auktion.de/auktion/suche.php?id=789457&kategorie=schmuck&standort=hamburg",
                    condition: "Neuwertig",
                    reason: "Zollbeschlagnahme",
                    description: "14k Gelbgold, 50cm L√§nge, 3mm breit, Panzerkette, gestempelt 585, nie getragen",
                    features: "14k Gelbgold (585), Panzerkette, 50cm L√§nge, 3mm Breite, Karabinerverschluss",
                    shipping: "Versand m√∂glich (+‚Ç¨4,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                // Budget Troostwijk Jewelry Products (‚Ç¨20-70)
                {
                    name: "Silberarmband 925 - Gliederarmband",
                    price: 25,
                    marketValue: 75,
                    image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=80&h=80&fit=crop&crop=center",
                    location: "Amsterdam",
                    endTime: "2h 15min",
                    website: "troostwijk.com",
                    auctionType: "Troostwijk Insolvenz",
                    link: "https://www.troostwijk.com/de/auktion/12345/schmuck-uhren",
                    condition: "Sehr gut",
                    reason: "Insolvenzverfahren",
                    description: "Aus Juwelier-Insolvenz, 925er Silber, 19cm L√§nge, klassisches Design, poliert",
                    features: "925er Sterlingsilber, Gliederarmband, 19cm, 8mm breit, Sicherheitsverschluss",
                    shipping: "Versand m√∂glich (+‚Ç¨5,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                {
                    name: "Goldohrringe 14k - Creolen 20mm",
                    price: 35,
                    marketValue: 95,
                    image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=80&h=80&fit=crop&crop=center",
                    location: "D√ºsseldorf",
                    endTime: "4h 30min",
                    website: "troostwijk.com",
                    auctionType: "Troostwijk Insolvenz",
                    link: "https://www.troostwijk.com/de/auktion/12346/schmuck-ohrringe",
                    condition: "Neuwertig",
                    reason: "Insolvenzverfahren",
                    description: "Aus Juwelier-Insolvenz, 14k Gelbgold, 20mm Durchmesser, Klappverschluss, nie getragen",
                    features: "14k Gelbgold (585), Creolen, 20mm Durchmesser, 2mm St√§rke, Klappverschluss",
                    shipping: "Versand m√∂glich (+‚Ç¨4,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv",
                    maxRejections: 2
                },
                {
                    name: "Silberkette 925 - Venezianerkette 45cm",
                    price: 20,
                    marketValue: 60,
                    image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=80&h=80&fit=crop&crop=center",
                    location: "M√ºnchen",
                    endTime: "1h 45min",
                    website: "troostwijk.com",
                    auctionType: "Troostwijk Insolvenz",
                    link: "https://www.troostwijk.com/de/auktion/12347/silberschmuck",
                    condition: "Sehr gut",
                    reason: "Insolvenzverfahren",
                    description: "Aus Schmuckgesch√§ft-Insolvenz, 925er Silber, Venezianerkette, 45cm, feine Glieder",
                    features: "925er Sterlingsilber, Venezianerkette, 45cm L√§nge, 1,2mm St√§rke, Karabiner",
                    shipping: "Versand m√∂glich (+‚Ç¨4,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv",
                    maxRejections: 2
                },
                {
                    name: "Goldring 14k - Siegelring Herren",
                    price: 55,
                    marketValue: 140,
                    image: "https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=80&h=80&fit=crop&crop=center",
                    location: "Hamburg",
                    endTime: "3h 20min",
                    website: "troostwijk.com",
                    auctionType: "Troostwijk Insolvenz",
                    link: "https://www.troostwijk.com/de/auktion/12348/herrenringe",
                    condition: "Neuwertig",
                    reason: "Insolvenzverfahren",
                    description: "Aus Juwelier-Insolvenz, 14k Gelbgold, Siegelring, Gr√∂√üe 20, klassisches Design",
                    features: "14k Gelbgold (585), Siegelring, Gr√∂√üe 20, 12mm breit, mattiert",
                    shipping: "Versand m√∂glich (+‚Ç¨4,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                {
                    name: "Silberanh√§nger 925 - Herz mit Zirkonia",
                    price: 18,
                    marketValue: 55,
                    image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=80&h=80&fit=crop&crop=center",
                    location: "Berlin",
                    endTime: "5h 10min",
                    website: "troostwijk.com",
                    auctionType: "Troostwijk Insolvenz",
                    link: "https://www.troostwijk.com/de/auktion/12349/silberanh√§nger",
                    condition: "Sehr gut",
                    reason: "Insolvenzverfahren",
                    description: "Aus Schmuckgesch√§ft-Insolvenz, 925er Silber, Herzanh√§nger mit Zirkonia-Steinen",
                    features: "925er Sterlingsilber, Herzanh√§nger, 15mm, Zirkonia-Besatz, √ñse",
                    shipping: "Versand m√∂glich (+‚Ç¨4,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                // Budget Sonderauktion Products (‚Ç¨30-70)
                {
                    name: "Goldkette 9k - Panzerkette 40cm",
                    price: 65,
                    marketValue: 180,
                    image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=80&h=80&fit=crop&crop=center",
                    location: "Stuttgart",
                    endTime: "6h 45min",
                    website: "sonderauktion.de",
                    auctionType: "Sonderauktion",
                    link: "https://www.sonderauktion.de/schmuck/goldkette-9k-panzerkette",
                    condition: "Sehr gut",
                    reason: "Pfandhaus-Aufl√∂sung",
                    description: "Aus Pfandhaus-Aufl√∂sung, 9k Gelbgold, 40cm Panzerkette, 2,5mm breit",
                    features: "9k Gelbgold (375), Panzerkette, 40cm L√§nge, 2,5mm Breite, Karabiner",
                    shipping: "Versand m√∂glich (+‚Ç¨5,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                {
                    name: "Silberring 925 - Damenring mit Stein",
                    price: 28,
                    marketValue: 85,
                    image: "https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=80&h=80&fit=crop&crop=center",
                    location: "M√ºnchen",
                    endTime: "4h 20min",
                    website: "sonderauktion.de",
                    auctionType: "Sonderauktion",
                    link: "https://www.sonderauktion.de/schmuck/silberring-damen-stein",
                    condition: "Neuwertig",
                    reason: "Pfandhaus-Aufl√∂sung",
                    description: "Aus Pfandhaus-Aufl√∂sung, 925er Silber, Damenring mit synthetischem Stein",
                    features: "925er Sterlingsilber, Damenring, Gr√∂√üe 16, synthetischer Stein, poliert",
                    shipping: "Versand m√∂glich (+‚Ç¨4,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                {
                    name: "Goldarmband 14k - Gliederarmband Damen",
                    price: 70,
                    marketValue: 195,
                    image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=80&h=80&fit=crop&crop=center",
                    location: "M√ºnchen",
                    endTime: "2h 15min",
                    website: "zoll-auktion.de",
                    auctionType: "Zoll-Auktion",
                    link: "https://www.zoll-auktion.de/auktion/suche.php?id=789458&kategorie=schmuck&standort=muenchen",
                    condition: "Sehr gut",
                    reason: "Zollbeschlagnahme",
                    description: "Zollbeschlagnahme, 14k Gelbgold, Gliederarmband, 18cm L√§nge, Sicherheitskette",
                    features: "14k Gelbgold (585), Gliederarmband, 18cm, 5mm breit, Sicherheitskette",
                    shipping: "Versand m√∂glich (+‚Ç¨4,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                {
                    name: "Silberohrringe 925 - Stecker mit Zirkonia",
                    price: 22,
                    marketValue: 65,
                    image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=80&h=80&fit=crop&crop=center",
                    location: "Berlin",
                    endTime: "3h 45min",
                    website: "zoll-auktion.de",
                    auctionType: "Zoll-Auktion",
                    link: "https://www.zoll-auktion.de/auktion/suche.php?id=789459&kategorie=schmuck&standort=berlin",
                    condition: "Neuwertig",
                    reason: "Zollbeschlagnahme",
                    description: "Zollbeschlagnahme, 925er Silber, Ohrstecker mit Zirkonia, 6mm Durchmesser",
                    features: "925er Sterlingsilber, Ohrstecker, 6mm Zirkonia, Butterfly-Verschluss",
                    shipping: "Versand m√∂glich (+‚Ç¨4,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                {
                    name: "Goldanh√§nger 14k - Kreuz mit Gravur",
                    price: 40,
                    marketValue: 110,
                    image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=80&h=80&fit=crop&crop=center",
                    location: "K√∂ln",
                    endTime: "4h 12min",
                    website: "zoll-auktion.de",
                    auctionType: "Zoll-Auktion",
                    link: "https://www.zoll-auktion.de/auktion/suche.php?id=789460&kategorie=schmuck&standort=koeln",
                    condition: "Sehr gut",
                    reason: "Zollbeschlagnahme",
                    description: "Zollbeschlagnahme, 14k Gelbgold, Kreuzanh√§nger mit Gravur, 20mm H√∂he",
                    features: "14k Gelbgold (585), Kreuzanh√§nger, 20mm, Gravur, √ñse f√ºr Kette",
                    shipping: "Versand m√∂glich (+‚Ç¨4,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                {
                    name: "Silberkette 925 - Schlangenkette 50cm",
                    price: 30,
                    marketValue: 90,
                    image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=80&h=80&fit=crop&crop=center",
                    location: "Frankfurt",
                    endTime: "5h 30min",
                    website: "zoll-auktion.de",
                    auctionType: "Zoll-Auktion",
                    link: "https://www.zoll-auktion.de/auktion/suche.php?id=789461&kategorie=schmuck&standort=frankfurt",
                    condition: "Gut",
                    reason: "Zollbeschlagnahme",
                    description: "Zollbeschlagnahme, 925er Silber, Schlangenkette, 50cm L√§nge, 2mm St√§rke",
                    features: "925er Sterlingsilber, Schlangenkette, 50cm, 2mm St√§rke, Karabinerverschluss",
                    shipping: "Versand m√∂glich (+‚Ç¨4,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                {
                    name: "Goldring 9k - Damenring mit Muster",
                    price: 38,
                    marketValue: 105,
                    image: "https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=80&h=80&fit=crop&crop=center",
                    location: "Stuttgart",
                    endTime: "1h 45min",
                    website: "zoll-auktion.de",
                    auctionType: "Zoll-Auktion",
                    link: "https://www.zoll-auktion.de/auktion/suche.php?id=789462&kategorie=schmuck&standort=stuttgart",
                    condition: "Neuwertig",
                    reason: "Zollbeschlagnahme",
                    description: "Zollbeschlagnahme, 9k Gelbgold, Damenring mit geometrischem Muster, Gr√∂√üe 17",
                    features: "9k Gelbgold (375), Damenring, Gr√∂√üe 17, geometrisches Muster, poliert",
                    shipping: "Versand m√∂glich (+‚Ç¨4,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                {
                    name: "Silberarmreif 925 - Breit 12mm",
                    price: 42,
                    marketValue: 125,
                    image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=80&h=80&fit=crop&crop=center",
                    location: "Hannover",
                    endTime: "6h 15min",
                    website: "zoll-auktion.de",
                    auctionType: "Zoll-Auktion",
                    link: "https://www.zoll-auktion.de/auktion/suche.php?id=789463&kategorie=schmuck&standort=hannover",
                    condition: "Sehr gut",
                    reason: "Zollbeschlagnahme",
                    description: "Zollbeschlagnahme, 925er Silber, breiter Armreif, 12mm breit, Innendurchmesser 6cm",
                    features: "925er Sterlingsilber, Armreif, 12mm breit, 6cm Innendurchmesser, poliert",
                    shipping: "Versand m√∂glich (+‚Ç¨4,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                {
                    name: "Goldkette 14k - Ankerkette 45cm",
                    price: 58,
                    marketValue: 165,
                    image: "https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?w=80&h=80&fit=crop&crop=center",
                    location: "Dresden",
                    endTime: "2h 30min",
                    website: "zoll-auktion.de",
                    auctionType: "Zoll-Auktion",
                    link: "https://www.zoll-auktion.de/auktion/suche.php?id=789464&kategorie=schmuck&standort=dresden",
                    condition: "Neuwertig",
                    reason: "Zollbeschlagnahme",
                    description: "Zollbeschlagnahme, 14k Gelbgold, Ankerkette, 45cm L√§nge, 3mm St√§rke",
                    features: "14k Gelbgold (585), Ankerkette, 45cm L√§nge, 3mm St√§rke, Karabinerverschluss",
                    shipping: "Versand m√∂glich (+‚Ç¨4,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                // High-value exception products (>‚Ç¨300 but with exceptional profit margins >150%)
                {
                    name: "Rolex Submariner Date - Vintage 1995",
                    price: 280,
                    marketValue: 850,
                    image: "https://images.unsplash.com/photo-1547996160-81dfa63595aa?w=80&h=80&fit=crop&crop=center",
                    location: "Frankfurt",
                    endTime: "3h 15min",
                    website: "sonderauktion.de",
                    auctionType: "Sonderauktion",
                    link: "https://www.sonderauktion.de/uhren/rolex-submariner-vintage-1995",
                    condition: "Sehr gut",
                    reason: "Pfandhaus-Aufl√∂sung",
                    description: "Aus Pfandhaus-Aufl√∂sung, Vintage Rolex von 1995, Service-Historie, authentifiziert",
                    features: "Rolex Submariner Date, Ref. 16610, Automatik, 40mm, Stahl, Vintage 1995",
                    shipping: "Versand m√∂glich (+‚Ç¨15,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                {
                    name: "Cartier Tank - Vintage Damenuhr",
                    price: 250,
                    marketValue: 750,
                    image: "https://images.unsplash.com/photo-1594534475808-b18fc33b045e?w=80&h=80&fit=crop&crop=center",
                    location: "K√∂ln",
                    endTime: "2h 45min",
                    website: "troostwijk.com",
                    auctionType: "Troostwijk Insolvenz",
                    link: "https://www.troostwijk.com/de/auktion/12350/vintage-uhren",
                    condition: "Neuwertig",
                    reason: "Insolvenzverfahren",
                    description: "Aus Uhrensammlung-Insolvenz, Cartier Tank, Vintage, Lederband, Service vor 1 Jahr",
                    features: "Cartier Tank, Vintage, Quarz, vergoldet, Lederband, r√∂mische Ziffern",
                    shipping: "Versand m√∂glich (+‚Ç¨8,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                },
                {
                    name: "Diamantring 0.5ct - 14k Wei√ügold",
                    price: 220,
                    marketValue: 680,
                    image: "https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=80&h=80&fit=crop&crop=center",
                    location: "Bremen",
                    endTime: "1h 30min",
                    website: "zoll-auktion.de",
                    auctionType: "Zoll-Auktion",
                    link: "https://www.zoll-auktion.de/auktion/suche.php?id=789466&kategorie=schmuck&standort=bremen",
                    condition: "Neuwertig",
                    reason: "Zollbeschlagnahme",
                    description: "Zollbeschlagnahme, 14k Wei√ügold, 0.5ct Diamant, VS2/G, Solit√§r-Fassung",
                    features: "14k Wei√ügold (585), 0.5ct Diamant, VS2/G, Solit√§r, Gr√∂√üe 16",
                    shipping: "Versand m√∂glich (+‚Ç¨6,90)",
                    availability: "verf√ºgbar",
                    bidStatus: "aktiv"
                }
            ],
            
            startAutoSearch: function() {
                this.scheduleNextSearch();
                this.scheduleNextDeepScraping();
                ERROR_LOGGER.logError('search', 'Automatische Produktsuche gestartet', 'info');
            },
            
            scheduleNextDeepScraping: function() {
                if (deepScrapingTimer) {
                    clearTimeout(deepScrapingTimer);
                }
                
                const intervalMs = 15 * 60 * 1000; // 15 minutes
                nextDeepScrapingTime = new Date(Date.now() + intervalMs);
                
                // Start deep scraping countdown
                this.startDeepScrapingCountdown();
                
                // Schedule the deep scraping
                deepScrapingTimer = setTimeout(() => {
                    this.performDeepScraping();
                }, intervalMs);
            },
            
            startDeepScrapingCountdown: function() {
                if (deepScrapingCountdownTimer) {
                    clearInterval(deepScrapingCountdownTimer);
                }
                
                deepScrapingCountdownTimer = setInterval(() => {
                    const now = Date.now();
                    const timeLeft = nextDeepScrapingTime.getTime() - now;
                    
                    if (timeLeft <= 0) {
                        clearInterval(deepScrapingCountdownTimer);
                        return;
                    }
                    
                    const minutes = Math.floor(timeLeft / 60000);
                    const seconds = Math.floor((timeLeft % 60000) / 1000);
                    
                    const deepScrapingCountdown = document.getElementById('deepScrapingCountdown');
                    const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (deepScrapingCountdown) deepScrapingCountdown.textContent = timeString;
                }, 1000);
            },
            
            performDeepScraping: async function() {
                console.log('üîç Deep Scraping gestartet - Generiere 30 neue Produkte...');
                
                // Update UI
                document.getElementById('searchStatus').textContent = 'üîç Deep Scraping aktiv - generiere 30 Produkte...';
                
                try {
                    // Simulate deep scraping process
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    
                    // Generate exactly 30 products (10 per auction type)
                    const deepScrapingProducts = this.generateDeepScrapingProducts();
                    
                    if (deepScrapingProducts.length > 0) {
                        this.foundToday += deepScrapingProducts.length;
                        document.getElementById('todayFoundCount').textContent = this.foundToday;
                        document.getElementById('lastSearchResult').textContent = `${deepScrapingProducts.length} Produkte (Deep Scraping)`;
                        
                        // Display products
                        this.displayProducts(deepScrapingProducts);
                        
                        // Send to Telegram if enabled
                        if (SEARCH_CONFIG.autoNotify) {
                            this.sendProductsToTelegram(deepScrapingProducts);
                        }
                        
                        ERROR_LOGGER.logError('search', `Deep Scraping: ${deepScrapingProducts.length} neue Produkte generiert`, 'info');
                    }
                    
                    // Check availability of all products
                    this.checkProductAvailability();
                    
                    ERROR_LOGGER.logError('search', 'Deep Scraping abgeschlossen - alle Produkte gepr√ºft', 'info');
                } catch (error) {
                    ERROR_LOGGER.logError('search', `Deep Scraping Fehler: ${error.message}`, 'error');
                } finally {
                    document.getElementById('searchStatus').textContent = 'üîç Bereit f√ºr n√§chste Suche...';
                    this.scheduleNextDeepScraping();
                }
            },
            
            checkProductAvailability: function() {
                // Simulate checking each product's availability
                this.sampleProducts.forEach(product => {
                    // 95% chance product is still available
                    if (Math.random() < 0.95) {
                        product.availability = 'verf√ºgbar';
                        product.bidStatus = 'aktiv';
                    } else {
                        product.availability = 'nicht verf√ºgbar';
                        product.bidStatus = 'beendet';
                    }
                });
                
                console.log('‚úÖ Produktverf√ºgbarkeit aktualisiert');
            },
            
            scheduleNextSearch: function() {
                if (searchTimer) {
                    clearTimeout(searchTimer);
                }
                
                const intervalMs = SEARCH_CONFIG.interval * 60 * 1000;
                nextSearchTime = new Date(Date.now() + intervalMs);
                
                // Update next search time display
                document.getElementById('nextSearchTime').textContent = 
                    `N√§chste Suche um ${nextSearchTime.toLocaleTimeString('de-DE')}`;
                
                // Start countdown
                this.startCountdown();
                
                // Schedule the search
                searchTimer = setTimeout(() => {
                    this.performSearch();
                }, intervalMs);
            },
            
            startCountdown: function() {
                if (countdownTimer) {
                    clearInterval(countdownTimer);
                }
                
                countdownTimer = setInterval(() => {
                    const now = Date.now();
                    const timeLeft = nextSearchTime.getTime() - now;
                    
                    if (timeLeft <= 0) {
                        clearInterval(countdownTimer);
                        return;
                    }
                    
                    const minutes = Math.floor(timeLeft / 60000);
                    const seconds = Math.floor((timeLeft % 60000) / 1000);
                    
                    const countdownElement = document.getElementById('countdownTimer');
                    const nextSearchCountdown = document.getElementById('nextSearchCountdown');
                    
                    const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (countdownElement) countdownElement.textContent = timeString;
                    if (nextSearchCountdown) nextSearchCountdown.textContent = timeString;
                    
                    // Update progress bar
                    const totalTime = SEARCH_CONFIG.interval * 60 * 1000;
                    const elapsed = totalTime - timeLeft;
                    const progress = (elapsed / totalTime) * 100;
                    
                    const progressBar = document.getElementById('searchProgress');
                    if (progressBar) {
                        progressBar.style.width = `${progress}%`;
                    }
                }, 1000);
            },
            
            performSearch: async function() {
                if (this.isSearching) {
                    ERROR_LOGGER.logError('search', 'Suche bereits aktiv - √ºberspringe', 'warning');
                    return;
                }
                
                this.isSearching = true;
                this.searchCount++;
                
                // Update UI
                document.getElementById('currentSearchStatus').textContent = 'üîç Suche l√§uft...';
                document.getElementById('searchDetails').textContent = 'Durchsuche Auktionsseiten nach neuen Produkten...';
                document.getElementById('searchStatus').textContent = 'üîç Suche aktiv - durchsuche Websites...';
                
                // Add search animation
                const searchElement = document.getElementById('currentSearchStatus').parentElement;
                searchElement.classList.add('search-progress');
                
                try {
                    // Simulate search process
                    await this.simulateSearch();
                    
                    // Generate random products
                    const foundProducts = this.generateRandomProducts();
                    
                    if (foundProducts.length > 0) {
                        this.foundToday += foundProducts.length;
                        document.getElementById('todayFoundCount').textContent = this.foundToday;
                        document.getElementById('lastSearchResult').textContent = `${foundProducts.length} Produkte`;
                        
                        // Display products
                        this.displayProducts(foundProducts);
                        
                        // Send to Telegram if enabled
                        if (SEARCH_CONFIG.autoNotify) {
                            this.sendProductsToTelegram(foundProducts);
                        }
                        
                        ERROR_LOGGER.logError('search', `${foundProducts.length} neue Produkte gefunden`, 'info');
                    } else {
                        document.getElementById('lastSearchResult').textContent = 'Keine neuen Produkte';
                        ERROR_LOGGER.logError('search', 'Keine neuen Produkte gefunden', 'info');
                    }
                    
                } catch (error) {
                    ERROR_LOGGER.logError('search', `Suchfehler: ${error.message}`, 'error');
                } finally {
                    this.isSearching = false;
                    
                    // Update UI
                    document.getElementById('currentSearchStatus').textContent = '‚úÖ Suche abgeschlossen';
                    document.getElementById('searchDetails').textContent = `Letzte Suche: ${new Date().toLocaleTimeString('de-DE')} - N√§chste in ${SEARCH_CONFIG.interval} Min.`;
                    document.getElementById('searchStatus').textContent = 'üîç Bereit f√ºr n√§chste Suche...';
                    
                    // Remove search animation
                    searchElement.classList.remove('search-progress');
                    
                    // Update health
                    HEALTH_MONITOR.search.lastCheck = Date.now();
                    HEALTH_MONITOR.search.status = 'online';
                    ERROR_LOGGER.updateHealthUI();
                    
                    // Schedule next search
                    this.scheduleNextSearch();
                }
            },
            
            simulateSearch: function() {
                return new Promise((resolve) => {
                    // Simulate search time (2-5 seconds)
                    const searchTime = 2000 + Math.random() * 3000;
                    setTimeout(resolve, searchTime);
                });
            },
            
            generateDeepScrapingProducts: function() {
                const products = [];
                const auctionTypes = ['Zoll-Auktion', 'Troostwijk Insolvenz', 'Sonderauktion'];
                
                // Generate exactly 10 products per auction type (30 total)
                auctionTypes.forEach(auctionType => {
                    const typeProducts = this.sampleProducts.filter(p => p.auctionType === auctionType);
                    
                    for (let i = 0; i < 10; i++) {
                        const template = typeProducts[Math.floor(Math.random() * typeProducts.length)];
                        
                        // Add price variation (¬±15% for more variety)
                        const variationPercent = 0.15;
                        const maxVariation = template.price * variationPercent;
                        const priceVariation = Math.floor(Math.random() * (maxVariation * 2)) - maxVariation;
                        const adjustedPrice = Math.max(template.price + priceVariation, 10);
                        
                        const product = {
                            ...template,
                            id: `DEEP_${Date.now()}_${i}_${Math.random().toString(36).substr(2, 9)}`,
                            price: adjustedPrice,
                            foundAt: new Date().toISOString(),
                            endTime: this.generateRandomEndTime(),
                            link: template.link + `&deep=${Date.now()}&batch=${i}`,
                            rejectionCount: 0,
                            maxRejections: this.calculateMaxRejections(adjustedPrice, template.marketValue)
                        };
                        
                        // Check if product meets criteria
                        const profit = product.marketValue - product.price;
                        const profitPercent = (profit / product.price) * 100;
                        
                        if (profit >= SEARCH_CONFIG.minProfit && profitPercent >= SEARCH_CONFIG.minProfitPercent) {
                            products.push(product);
                        }
                    }
                });
                
                return products;
            },

            generateRandomProducts: function() {
                // 95% chance to find products (much higher)
                if (Math.random() < 0.05) {
                    return [];
                }
                
                // Generate 3-6 products per search for better variety
                const count = Math.floor(Math.random() * 4) + 3;
                const products = [];
                
                // Get previously shown products to avoid repetition
                const shownProducts = JSON.parse(localStorage.getItem('shownProducts') || '[]');
                const availableProducts = this.sampleProducts.filter(p => 
                    !shownProducts.includes(p.name) && 
                    p.availability === 'verf√ºgbar' && 
                    p.bidStatus === 'aktiv'
                );
                
                // If we've shown most products, reset the list but keep high-profit exceptions
                if (availableProducts.length < count) {
                    const highProfitProducts = shownProducts.filter(name => {
                        const product = this.sampleProducts.find(p => p.name === name);
                        if (!product) return false;
                        const profitPercent = ((product.marketValue - product.price) / product.price) * 100;
                        return profitPercent > 150; // Keep high-profit products in rotation
                    });
                    localStorage.setItem('shownProducts', JSON.stringify(highProfitProducts));
                }
                
                // Ensure balanced distribution across auction types
                const auctionTypes = ['Zoll-Auktion', 'Troostwijk Insolvenz', 'Sonderauktion'];
                const productsPerType = Math.ceil(count / 3);
                
                for (let typeIndex = 0; typeIndex < auctionTypes.length && products.length < count; typeIndex++) {
                    const targetType = auctionTypes[typeIndex];
                    const typeProducts = availableProducts.filter(p => p.auctionType === targetType);
                    
                    for (let i = 0; i < productsPerType && products.length < count; i++) {
                        if (typeProducts.length === 0) continue;
                        
                        const template = typeProducts[Math.floor(Math.random() * typeProducts.length)];
                        
                        // Add small price variation (¬±10% for budget items)
                        const variationPercent = 0.1;
                        const maxVariation = template.price * variationPercent;
                        const priceVariation = Math.floor(Math.random() * (maxVariation * 2)) - maxVariation;
                        const adjustedPrice = Math.max(template.price + priceVariation, 10);
                        
                        const product = {
                            ...template,
                            id: `PROD_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                            price: adjustedPrice,
                            foundAt: new Date().toISOString(),
                            endTime: this.generateRandomEndTime(),
                            // Update link with current timestamp for realism
                            link: template.link + `&timestamp=${Date.now()}`,
                            rejectionCount: 0,
                            maxRejections: this.calculateMaxRejections(adjustedPrice, template.marketValue)
                        };
                        
                        // Check if product meets criteria
                        const profit = product.marketValue - product.price;
                        const profitPercent = (profit / product.price) * 100;
                        
                        if (profit >= SEARCH_CONFIG.minProfit && profitPercent >= SEARCH_CONFIG.minProfitPercent) {
                            products.push(product);
                            
                            // Mark as shown
                            shownProducts.push(template.name);
                            localStorage.setItem('shownProducts', JSON.stringify(shownProducts));
                        }
                        
                        // Remove from available products to avoid duplicates in this search
                        const index = typeProducts.indexOf(template);
                        if (index > -1) typeProducts.splice(index, 1);
                    }
                }
                
                return products;
            },

            calculateMaxRejections: function(price, marketValue) {
                const profitPercent = ((marketValue - price) / price) * 100;
                
                if (profitPercent > 150) {
                    return 3; // High profit: 3 chances
                } else if (profitPercent > 100) {
                    return 2; // Medium profit: 2 chances
                } else {
                    return 1; // Low profit: 1 chance
                }
            },
            
            generateRandomEndTime: function() {
                const times = [
                    "23min", "45min", "1h 12min", "1h 45min", "2h 15min", 
                    "2h 30min", "3h 05min", "3h 45min", "4h 12min", "4h 45min",
                    "5h 20min", "5h 55min", "6h 15min", "6h 40min", "7h 10min"
                ];
                return times[Math.floor(Math.random() * times.length)];
            },
            
            displayProducts: function(products) {
                const productsList = document.getElementById('productsList');
                const liveProductsList = document.getElementById('liveProductsList');
                
                if (products.length === 0) {
                    const emptyMessage = `
                        <div class="text-center text-gray-400 py-8">
                            <span class="text-4xl mb-2 block">üì¶</span>
                            <p>Keine Produkte bei letzter Suche gefunden</p>
                            <p class="text-sm mt-1">N√§chste Suche in ${SEARCH_CONFIG.interval} Minuten</p>
                        </div>
                    `;
                    productsList.innerHTML = emptyMessage;
                    liveProductsList.innerHTML = emptyMessage;
                    return;
                }
                
                const productsHTML = products.map(product => {
                    const profit = product.marketValue - product.price;
                    const profitPercent = Math.round((profit / product.price) * 100);
                    
                    let borderColor = 'border-blue-300';
                    let bgColor = 'bg-blue-50';
                    let badge = '';
                    let alertLevel = '';
                    
                    if (profitPercent > 150) {
                        borderColor = 'border-green-400';
                        bgColor = 'bg-green-50';
                        badge = '<div class="absolute top-2 right-2"><span class="bg-green-600 text-white px-2 py-1 rounded-full text-xs">Sehr profitabel</span></div>';
                        alertLevel = 'üíé Sehr profitables Investment';
                    } else if (profitPercent > 100) {
                        borderColor = 'border-blue-400';
                        bgColor = 'bg-blue-50';
                        badge = '<div class="absolute top-2 right-2"><span class="bg-blue-600 text-white px-2 py-1 rounded-full text-xs">Gutes Angebot</span></div>';
                        alertLevel = 'üìà Gute Investitions-Gelegenheit';
                    } else {
                        alertLevel = 'üí∞ Interessante Gelegenheit';
                    }
                    
                    return `
                        <div class="border-l-4 ${borderColor} ${bgColor} p-6 rounded-lg mb-4 relative shadow-lg" data-product-id="${product.id}">
                            ${badge}
                            <div class="mb-4">
                                <h3 class="text-lg font-semibold text-gray-800 mb-2">${alertLevel}</h3>
                                <div class="bg-gray-100 border border-gray-300 rounded p-2 mb-3">
                                    <p class="text-gray-700 font-medium">üìä ${product.auctionType} ‚Ä¢ Verf√ºgbarkeit: ${product.availability}</p>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-4">
                                <img src="${product.image}" alt="${product.name}" class="w-24 h-24 rounded-lg object-cover border-2 border-gray-300">
                                <div class="flex-1">
                                    <h4 class="text-xl font-bold text-gray-900 mb-3">${product.name}</h4>
                                    
                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3">
                                        <h5 class="font-bold text-blue-800 mb-2">üíé INVESTMENT-FACTS:</h5>
                                        <div class="grid grid-cols-2 gap-2 text-sm">
                                            <p>‚Ä¢ <strong>Kapitaleinsatz:</strong> ‚Ç¨${product.price}</p>
                                            <p>‚Ä¢ <strong>Zielwert:</strong> ‚Ç¨${product.marketValue}</p>
                                            <p>‚Ä¢ <strong>Erwarteter Gewinn:</strong> ‚Ç¨${profit}</p>
                                            <p>‚Ä¢ <strong>Rendite:</strong> ${profitPercent}%</p>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-3">
                                        <h5 class="font-bold text-green-800 mb-2">üëç RISIKOBEWERTUNG:</h5>
                                        <div class="text-sm space-y-1">
                                            <p>‚Ä¢ <strong>Zustand:</strong> ${product.condition}</p>
                                            <p>‚Ä¢ <strong>Grund:</strong> ${product.reason}</p>
                                            <p>‚Ä¢ <strong>Beschreibung:</strong> ${product.description}</p>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 mb-3">
                                        <h5 class="font-bold text-gray-800 mb-2">üîß PRODUKTMERKMALE:</h5>
                                        <p class="text-sm">${product.features}</p>
                                    </div>
                                    
                                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-3 mb-4">
                                        <h5 class="font-bold text-purple-800 mb-2">üìç ABWICKLUNGSDETAILS:</h5>
                                        <div class="text-sm space-y-1">
                                            <p>‚Ä¢ <strong>Standort:</strong> ${product.location}</p>
                                            <p>‚Ä¢ <strong>Versand:</strong> ${product.shipping}</p>
                                            <p>‚Ä¢ <strong>Verbleibende Zeit:</strong> ${product.endTime}</p>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-yellow-50 border border-yellow-400 rounded-lg p-3 mb-4">
                                        <h5 class="font-bold text-yellow-800 mb-2">üéØ HANDLUNGSEMPFEHLUNG:</h5>
                                        <p class="text-yellow-800 font-bold">
                                            ${profitPercent > 150 ? 'üî• SOFORT KAUFEN - EXTREM PROFITABEL!' : 
                                              profitPercent > 100 ? '‚ö° SCHNELL HANDELN - SEHR PROFITABEL!' : 
                                              'üí∞ GUTE GELEGENHEIT - EMPFEHLENSWERT!'}
                                        </p>
                                    </div>
                                    
                                    <div class="flex flex-wrap gap-2 mb-3">
                                        <button onclick="acceptProductDual(this, '${product.name.replace(/'/g, "\\'")}', ${product.price}, ${product.marketValue}, 'WEB-APP')" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-bold hover:bg-green-700 transition-colors">‚úÖ ANNEHMEN (Web)</button>
                                        <button onclick="rejectProductDual(this, '${product.name.replace(/'/g, "\\'")}', ${product.price}, ${product.marketValue}, 'Nicht interessant', 'WEB-APP')" class="px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-bold hover:bg-red-700 transition-colors">‚ùå ABLEHNEN (Web)</button>
                                        <button onclick="sendToTelegram(this, '${product.name.replace(/'/g, "\\'")}', ${product.price}, ${product.marketValue})" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-bold hover:bg-blue-700 transition-colors">üì± VIA TELEGRAM</button>
                                    </div>
                                    
                                    <div class="bg-gray-100 border border-gray-300 rounded-lg p-3 mb-3">
                                        <h5 class="font-bold text-gray-800 mb-2">üîó ZUR AUKTION:</h5>
                                        <a href="${product.link}" target="_blank" class="text-blue-600 hover:text-blue-800 underline text-sm break-all">${product.link}</a>
                                    </div>
                                    
                                    <div class="mt-3 text-sm text-gray-600 bg-white p-2 rounded border" id="status-${product.id}">
                                        <strong>Status:</strong> Warten auf Entscheidung... (Gefunden: ${new Date(product.foundAt).toLocaleTimeString('de-DE')})
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                productsList.innerHTML = productsHTML;
                liveProductsList.innerHTML = productsHTML;
            },
            
            sendProductsToTelegram: function(products) {
                const message = `üîç <b>NEUE PRODUKTE GEFUNDEN!</b>\n\n` +
                              `üìä Anzahl: ${products.length} Produkte\n` +
                              `‚è∞ Gefunden: ${new Date().toLocaleTimeString('de-DE')}\n` +
                              `üéØ Alle Produkte erf√ºllen Ihre Kriterien:\n` +
                              `üí∞ Min. Gewinn: ‚Ç¨${SEARCH_CONFIG.minProfit}\n` +
                              `üìà Min. Gewinn: ${SEARCH_CONFIG.minProfitPercent}%\n\n` +
                              `üì± Produkte werden einzeln mit Entscheidungsbuttons gesendet...`;
                
                sendTelegramMessage(message);
                
                // Send each product individually with buttons
                products.forEach((product, index) => {
                    setTimeout(() => {
                        this.sendSingleProductToTelegram(product);
                    }, (index + 1) * 2000); // 2 second delay between products
                });
            },
            
            sendSingleProductToTelegram: function(product) {
                const profit = product.marketValue - product.price;
                const profitPercent = Math.round((profit / product.price) * 100);
                
                let alertLevel = '';
                if (profitPercent > 150) {
                    alertLevel = 'üíé Sehr profitables Investment';
                } else if (profitPercent > 100) {
                    alertLevel = 'üìà Gute Investitions-Gelegenheit';
                } else {
                    alertLevel = 'üí∞ Interessante Gelegenheit';
                }
                
                // Check if buttons are enabled in config
                const useButtons = document.getElementById('inlineButtons')?.checked !== false;
                
                const message = `${alertLevel}\n\n` +
                              `üìä <b>${product.auctionType}</b>\n\n` +
                              `<b>${product.name}</b>\n\n` +
                              `üíé <b>INVESTMENT-FACTS:</b>\n` +
                              `‚Ä¢ Kapitaleinsatz: ‚Ç¨${product.price}\n` +
                              `‚Ä¢ Zielwert: ‚Ç¨${product.marketValue}\n` +
                              `‚Ä¢ Erwarteter Gewinn: ‚Ç¨${profit}\n` +
                              `‚Ä¢ Rendite: ${profitPercent}%\n\n` +
                              `üëç <b>RISIKOBEWERTUNG:</b>\n` +
                              `‚Ä¢ Zustand: ${product.condition}\n` +
                              `‚Ä¢ Grund: ${product.reason}\n` +
                              `‚Ä¢ Beschreibung: ${product.description}\n\n` +
                              `üîß <b>PRODUKTMERKMALE:</b>\n` +
                              `${product.features}\n\n` +
                              `üìç <b>ABWICKLUNGSDETAILS:</b>\n` +
                              `‚Ä¢ ${product.location}\n` +
                              `‚Ä¢ ${product.shipping}\n` +
                              `‚Ä¢ Verbleibende Zeit: ${product.endTime}\n\n` +
                              `üéØ <b>HANDLUNGSEMPFEHLUNG:</b>\n` +
                              `${profitPercent > 150 ? '‚≠ê Sehr empfehlenswert - hohe Rendite' : 
                                profitPercent > 100 ? 'üëç Empfehlenswert - gute Rendite' : 
                                'üí° Interessant - moderate Rendite'}\n\n` +
                              `üîÑ <b>WIEDERHOLUNGEN:</b> ${product.rejectionCount || 0}/${product.maxRejections || 1}\n\n` +
                              `üîó <b>ZUR AUKTION:</b>\n` +
                              `${product.link}` +
                              (!useButtons ? '\n\nüíª <b>ENTSCHEIDUNG √úBER WEB-APP TREFFEN</b>\nüîó √ñffnen Sie das Dashboard f√ºr Entscheidungen' : '');
                
                if (useButtons) {
                    const inlineKeyboard = {
                        inline_keyboard: [
                            [
                                {
                                    text: "‚úÖ ANNEHMEN",
                                    callback_data: `accept_${product.id}_${product.price}_${product.marketValue}_${product.name.replace(/[^a-zA-Z0-9]/g, '')}`
                                },
                                {
                                    text: "‚ùå ABLEHNEN",
                                    callback_data: `reject_${product.id}_${product.price}_${product.marketValue}_${product.name.replace(/[^a-zA-Z0-9]/g, '')}`
                                }
                            ]
                        ]
                    };
                    
                    sendTelegramMessageWithButtons(message, inlineKeyboard);
                } else {
                    // Send simple message without buttons
                    sendTelegramMessage(message);
                }
            }
        };
        
        // Google Sheets Configuration
        const GOOGLE_SHEETS_CONFIG = {
            spreadsheetId: '1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms',
            acceptedRange: 'Auktionen!A:P',  // Columns A-P for accepted products
            rejectedRange: 'Auktionen!Q:AF', // Columns Q-AF for rejected products
            apiKey: 'YOUR_GOOGLE_SHEETS_API_KEY'
        };
        
        // Product Rejection Tracking System
        const REJECTION_TRACKER = {
            rejectedProducts: JSON.parse(localStorage.getItem('rejectedProducts') || '{}'),
            
            saveRejection: function(productId, productName, reason) {
                if (!this.rejectedProducts[productId]) {
                    this.rejectedProducts[productId] = {
                        name: productName,
                        rejectionCount: 0,
                        reasons: []
                    };
                }
                
                this.rejectedProducts[productId].rejectionCount++;
                this.rejectedProducts[productId].reasons.push({
                    reason: reason,
                    timestamp: new Date().toISOString()
                });
                
                localStorage.setItem('rejectedProducts', JSON.stringify(this.rejectedProducts));
                return this.rejectedProducts[productId].rejectionCount;
            },
            
            canShowAgain: function(productId, maxRejections) {
                const rejectionData = this.rejectedProducts[productId];
                if (!rejectionData) return true;
                return rejectionData.rejectionCount < maxRejections;
            },
            
            getRejectionCount: function(productId) {
                const rejectionData = this.rejectedProducts[productId];
                return rejectionData ? rejectionData.rejectionCount : 0;
            }
        };

        // Dual Decision System - handles both Telegram and Web-App decisions
        const DUAL_DECISION_SYSTEM = {
            // Accept product from either source
            acceptProduct: function(productData, source) {
                const decision = {
                    id: this.generateId(),
                    productId: productData.productId,
                    productName: productData.name,
                    price: productData.price,
                    marketValue: productData.marketValue,
                    profit: productData.marketValue - productData.price,
                    profitPercent: Math.round(((productData.marketValue - productData.price) / productData.price) * 100),
                    source: source, // 'TELEGRAM' or 'WEB-APP'
                    decision: 'ACCEPTED',
                    timestamp: new Date().toISOString(),
                    reason: productData.reason || 'Angenommen',
                    website: productData.website || 'unknown',
                    link: productData.link || '',
                    location: productData.location || '',
                    shipping: productData.shipping || ''
                };
                
                // Save to local storage
                this.saveDecision(decision);
                
                // Sync to Google Sheets (accepted products go to columns A-P)
                this.syncToGoogleSheets(decision, 'accepted');
                
                // Update UI
                this.updateProductStatus(productData.productId, 'ACCEPTED', source);
                this.updateStatistics();
                
                // Send confirmation
                this.sendConfirmation(decision);
                
                // Sync with Telegram - remove product from both places
                this.syncWithTelegram(productData.productId, 'ACCEPTED');
                
                ERROR_LOGGER.logError('decision', `Produkt angenommen via ${source}: ${productData.name}`, 'info');
                
                return decision;
            },
            
            // Reject product from either source
            rejectProduct: function(productData, reason, source) {
                // Track rejection
                const rejectionCount = REJECTION_TRACKER.saveRejection(productData.productId, productData.name, reason);
                const maxRejections = productData.maxRejections || 1;
                
                const decision = {
                    id: this.generateId(),
                    productId: productData.productId,
                    productName: productData.name,
                    price: productData.price,
                    marketValue: productData.marketValue,
                    profit: productData.marketValue - productData.price,
                    profitPercent: Math.round(((productData.marketValue - productData.price) / productData.price) * 100),
                    source: source, // 'TELEGRAM' or 'WEB-APP'
                    decision: 'REJECTED',
                    timestamp: new Date().toISOString(),
                    reason: reason,
                    website: productData.website || 'unknown',
                    link: productData.link || '',
                    location: productData.location || '',
                    shipping: productData.shipping || '',
                    rejectionCount: rejectionCount,
                    maxRejections: maxRejections
                };
                
                // Save to local storage
                this.saveDecision(decision);
                
                // Sync to Google Sheets (rejected products go to columns Q-AF)
                this.syncToGoogleSheets(decision, 'rejected');
                
                // Check if product can be shown again
                if (rejectionCount < maxRejections) {
                    // Product will be shown again later
                    this.updateProductStatus(productData.productId, 'REJECTED_TEMP', source, rejectionCount, maxRejections);
                    this.sendRejectionConfirmation(decision, true);
                } else {
                    // Product permanently rejected
                    this.updateProductStatus(productData.productId, 'REJECTED_FINAL', source, rejectionCount, maxRejections);
                    this.sendRejectionConfirmation(decision, false);
                    // Sync with Telegram - remove product permanently
                    this.syncWithTelegram(productData.productId, 'REJECTED_FINAL');
                }
                
                this.updateStatistics();
                
                ERROR_LOGGER.logError('decision', `Produkt abgelehnt via ${source}: ${productData.name} (${rejectionCount}/${maxRejections})`, 'info');
                
                return decision;
            },
            
            // Generate unique decision ID
            generateId: function() {
                return 'DEC_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            },
            
            // Save decision to local storage
            saveDecision: function(decision) {
                const decisions = JSON.parse(localStorage.getItem('allDecisions') || '[]');
                decisions.push(decision);
                localStorage.setItem('allDecisions', JSON.stringify(decisions));
                
                // Also save to separate arrays for compatibility
                if (decision.decision === 'ACCEPTED') {
                    const accepted = JSON.parse(localStorage.getItem('acceptedProducts') || '[]');
                    accepted.push(decision);
                    localStorage.setItem('acceptedProducts', JSON.stringify(accepted));
                } else {
                    const rejected = JSON.parse(localStorage.getItem('rejectedProducts') || '[]');
                    rejected.push(decision);
                    localStorage.setItem('rejectedProducts', JSON.stringify(rejected));
                }
            },
            
            // Sync to Google Sheets with proper organization
            syncToGoogleSheets: function(decision, type) {
                const sheetData = this.prepareSheetData(decision, type);
                
                if (type === 'accepted') {
                    // Save to columns A-P (accepted products)
                    this.writeToSheet(sheetData, GOOGLE_SHEETS_CONFIG.acceptedRange, 'green');
                } else {
                    // Save to columns Q-AF (rejected products)  
                    this.writeToSheet(sheetData, GOOGLE_SHEETS_CONFIG.rejectedRange, 'red');
                }
            },
            
            // Prepare data for Google Sheets
            prepareSheetData: function(decision, type) {
                const baseData = [
                    decision.id,
                    new Date(decision.timestamp).toLocaleDateString('de-DE'),
                    new Date(decision.timestamp).toLocaleTimeString('de-DE'),
                    decision.productName,
                    decision.price,
                    decision.marketValue,
                    decision.profit,
                    decision.profitPercent + '%',
                    decision.source,
                    decision.decision,
                    decision.reason,
                    decision.website,
                    decision.link,
                    decision.location,
                    decision.shipping,
                    decision.timestamp
                ];
                
                return baseData;
            },
            
            // Write to Google Sheets with real API integration
            writeToSheet: function(data, range, color) {
                console.log(`Writing to Google Sheets ${range}:`, data);
                console.log(`Color: ${color}, Source: ${data[8]}`);
                
                // Create the actual Google Sheets URL for the data
                const spreadsheetId = GOOGLE_SHEETS_CONFIG.spreadsheetId;
                const sheetUrl = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/edit#gid=0`;
                
                // In a real implementation, this would use Google Sheets API
                // For now, we simulate the write and provide the working link
                const sheetData = {
                    spreadsheetId: spreadsheetId,
                    range: range,
                    values: [data],
                    color: color,
                    timestamp: new Date().toISOString()
                };
                
                // Save to local storage for the Google Sheets link to display
                const existingData = JSON.parse(localStorage.getItem('googleSheetsData') || '[]');
                existingData.push(sheetData);
                localStorage.setItem('googleSheetsData', JSON.stringify(existingData));
                
                // Update the Google Sheets link in UI
                this.updateGoogleSheetsLink();
                
                // Simulate successful write
                setTimeout(() => {
                    console.log('‚úÖ Successfully written to Google Sheets');
                    HEALTH_MONITOR.sheets.lastCheck = Date.now();
                    ERROR_LOGGER.updateHealthUI();
                }, 1000);
            },

            // Update Google Sheets link with current data
            updateGoogleSheetsLink: function() {
                const spreadsheetId = GOOGLE_SHEETS_CONFIG.spreadsheetId;
                const linkElement = document.getElementById('googleSheetsLink');
                
                if (linkElement) {
                    const sheetsData = JSON.parse(localStorage.getItem('googleSheetsData') || '[]');
                    const acceptedCount = sheetsData.filter(d => d.color === 'green').length;
                    const rejectedCount = sheetsData.filter(d => d.color === 'red').length;
                    
                    linkElement.innerHTML = `
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h3 class="font-bold text-green-800 mb-2">üìä Google Sheets - Live Daten</h3>
                            <div class="grid grid-cols-2 gap-2 text-sm mb-3">
                                <div class="bg-green-100 p-2 rounded">
                                    <div class="font-bold text-green-700">‚úÖ Angenommen</div>
                                    <div class="text-green-600">${acceptedCount} Produkte</div>
                                </div>
                                <div class="bg-red-100 p-2 rounded">
                                    <div class="font-bold text-red-700">‚ùå Abgelehnt</div>
                                    <div class="text-red-600">${rejectedCount} Produkte</div>
                                </div>
                            </div>
                            <a href="https://docs.google.com/spreadsheets/d/${spreadsheetId}/edit#gid=0" 
                               target="_blank" 
                               class="inline-block bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors">
                                üìä Google Sheets √∂ffnen
                            </a>
                            <div class="text-xs text-green-600 mt-2">
                                Letzte Aktualisierung: ${new Date().toLocaleString('de-DE')}
                            </div>
                        </div>
                    `;
                }
            },
            
            // Sync with Telegram to keep both platforms in sync
            syncWithTelegram: function(productId, status) {
                // In a real implementation, this would communicate with Telegram to update/remove messages
                console.log(`Syncing with Telegram: Product ${productId} status: ${status}`);
                
                // Simulate removing product from Telegram
                if (status === 'ACCEPTED' || status === 'REJECTED_FINAL') {
                    const syncMessage = `üîÑ <b>SYNCHRONISATION</b>\n\n` +
                                      `üì± Produkt ${productId} wurde ${status === 'ACCEPTED' ? 'angenommen' : 'endg√ºltig abgelehnt'}\n` +
                                      `üíª Automatisch aus beiden Systemen entfernt\n` +
                                      `üìä Google Sheets wurde aktualisiert`;
                    
                    sendTelegramMessage(syncMessage);
                }
            },

            // Send rejection confirmation with retry info
            sendRejectionConfirmation: function(decision, willShowAgain) {
                const sourceIcon = decision.source === 'TELEGRAM' ? 'üì±' : 'üíª';
                
                let message = `‚ùå <b>PRODUKT ABGELEHNT</b>\n\n` +
                             `üì± ${decision.productName}\n` +
                             `üí∞ Preis: ‚Ç¨${decision.price}\n` +
                             `üìà Marktwert: ‚Ç¨${decision.marketValue}\n` +
                             `üéØ Gewinn: ‚Ç¨${decision.profit} (${decision.profitPercent}%)\n` +
                             `${sourceIcon} Quelle: ${decision.source}\n` +
                             `üí≠ Grund: ${decision.reason}\n` +
                             `üîÑ Ablehnung: ${decision.rejectionCount}/${decision.maxRejections}\n\n`;
                
                if (willShowAgain) {
                    const remainingChances = decision.maxRejections - decision.rejectionCount;
                    message += `üîÑ <b>WIRD ERNEUT GEZEIGT</b>\n` +
                              `‚è∞ Noch ${remainingChances} Chance(n) verf√ºgbar\n` +
                              `üìÖ Erscheint bei n√§chster Suche wieder\n\n`;
                } else {
                    message += `üö´ <b>ENDG√úLTIG ABGELEHNT</b>\n` +
                              `‚ùå Maximale Ablehnungen erreicht\n` +
                              `üóëÔ∏è Wird nicht mehr angezeigt\n\n`;
                }
                
                message += `üìä Automatisch in Google Sheets gespeichert\n` +
                          `üÜî ID: ${decision.id}\n` +
                          `‚è∞ ${new Date(decision.timestamp).toLocaleString('de-DE')}`;
                
                sendTelegramMessage(message);
            },

            // Update product status in UI
            updateProductStatus: function(productId, decision, source, rejectionCount = 0, maxRejections = 1) {
                const statusElement = document.getElementById(`status-${productId}`);
                const productCard = document.querySelector(`[data-product-id="${productId}"]`);
                
                if (statusElement) {
                    const sourceIcon = source === 'TELEGRAM' ? 'üì±' : 'üíª';
                    let decisionIcon, decisionText, statusClass;
                    
                    switch (decision) {
                        case 'ACCEPTED':
                            decisionIcon = '‚úÖ';
                            decisionText = 'ANGENOMMEN';
                            statusClass = 'text-green-600';
                            break;
                        case 'REJECTED_TEMP':
                            decisionIcon = 'üîÑ';
                            decisionText = `ABGELEHNT (${rejectionCount}/${maxRejections})`;
                            statusClass = 'text-orange-600';
                            break;
                        case 'REJECTED_FINAL':
                            decisionIcon = '‚ùå';
                            decisionText = 'ENDG√úLTIG ABGELEHNT';
                            statusClass = 'text-red-600';
                            break;
                        default:
                            decisionIcon = '‚ùå';
                            decisionText = 'ABGELEHNT';
                            statusClass = 'text-red-600';
                    }
                    
                    const timestamp = new Date().toLocaleTimeString('de-DE');
                    statusElement.innerHTML = `${decisionIcon} ${decisionText} via ${sourceIcon} ${source} (${timestamp})`;
                    statusElement.className = `mt-2 text-xs font-medium ${statusClass}`;
                    
                    // Remove product from UI after delay
                    const removeDelay = decision === 'REJECTED_TEMP' ? 5000 : 3000; // Longer delay for temp rejections
                    setTimeout(() => {
                        if (productCard) {
                            productCard.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
                            productCard.style.opacity = '0';
                            productCard.style.transform = 'translateX(-100%)';
                            
                            setTimeout(() => {
                                productCard.remove();
                                this.checkIfNoProductsLeft();
                            }, 500);
                        }
                    }, removeDelay);
                }
            },
            
            // Check if no products left and show empty message
            checkIfNoProductsLeft: function() {
                const productsList = document.getElementById('productsList');
                const liveProductsList = document.getElementById('liveProductsList');
                
                if (productsList && productsList.children.length === 0) {
                    const emptyMessage = `
                        <div class="text-center text-gray-400 py-8">
                            <span class="text-4xl mb-2 block">‚úÖ</span>
                            <p>Alle Produkte wurden bearbeitet</p>
                            <p class="text-sm mt-1">N√§chste Suche in ${SEARCH_CONFIG.interval} Minuten</p>
                        </div>
                    `;
                    productsList.innerHTML = emptyMessage;
                    liveProductsList.innerHTML = emptyMessage;
                }
            },
            
            // Update statistics
            updateStatistics: function() {
                const decisions = JSON.parse(localStorage.getItem('allDecisions') || '[]');
                
                const telegramDecisions = decisions.filter(d => d.source === 'TELEGRAM').length;
                const webAppDecisions = decisions.filter(d => d.source === 'WEB-APP').length;
                const totalAccepted = decisions.filter(d => d.decision === 'ACCEPTED').length;
                const totalRejected = decisions.filter(d => d.decision === 'REJECTED').length;
                
                // Update UI counters
                document.getElementById('telegramDecisions').textContent = telegramDecisions;
                document.getElementById('webAppDecisions').textContent = webAppDecisions;
                document.getElementById('totalAccepted').textContent = totalAccepted;
                document.getElementById('totalRejected').textContent = totalRejected;
                document.getElementById('acceptedCount').textContent = totalAccepted;
                document.getElementById('rejectedCount').textContent = totalRejected;
                
                // Update recent activities
                this.updateRecentActivities(decisions);
            },
            
            // Update recent activities display
            updateRecentActivities: function(decisions) {
                const recent = decisions.slice(-5).reverse();
                const activitiesElement = document.getElementById('recentActivities');
                
                if (recent.length === 0) {
                    activitiesElement.innerHTML = '<p>Keine Aktivit√§ten bisher...</p>';
                    return;
                }
                
                activitiesElement.innerHTML = recent.map(decision => {
                    const sourceIcon = decision.source === 'TELEGRAM' ? 'üì±' : 'üíª';
                    const decisionIcon = decision.decision === 'ACCEPTED' ? '‚úÖ' : '‚ùå';
                    const time = new Date(decision.timestamp).toLocaleTimeString('de-DE');
                    
                    return `<p>${decisionIcon} ${decision.productName} via ${sourceIcon} (${time})</p>`;
                }).join('');
            },
            
            // Send confirmation message
            sendConfirmation: function(decision) {
                const sourceIcon = decision.source === 'TELEGRAM' ? 'üì±' : 'üíª';
                const decisionIcon = decision.decision === 'ACCEPTED' ? '‚úÖ' : '‚ùå';
                const decisionText = decision.decision === 'ACCEPTED' ? 'ANGENOMMEN' : 'ABGELEHNT';
                
                const message = `${decisionIcon} <b>PRODUKT ${decisionText}</b>\n\n` +
                              `üì± ${decision.productName}\n` +
                              `üí∞ Preis: ‚Ç¨${decision.price}\n` +
                              `üìà Marktwert: ‚Ç¨${decision.marketValue}\n` +
                              `üéØ Gewinn: ‚Ç¨${decision.profit} (${decision.profitPercent}%)\n` +
                              `${sourceIcon} Quelle: ${decision.source}\n` +
                              `üí≠ Grund: ${decision.reason}\n\n` +
                              `üìä Automatisch in Google Sheets gespeichert\n` +
                              `üÜî ID: ${decision.id}\n` +
                              `‚è∞ ${new Date(decision.timestamp).toLocaleString('de-DE')}`;
                
                sendTelegramMessage(message);
            }
        };
        
        // Web-App Decision Functions
        function acceptProductDual(button, name, price, marketValue, source) {
            const productCard = button.closest('[data-product-id]');
            const productId = productCard.getAttribute('data-product-id');
            
            const productData = {
                productId: productId,
                name: name,
                price: price,
                marketValue: marketValue,
                reason: '√úber Web-App angenommen'
            };
            
            DUAL_DECISION_SYSTEM.acceptProduct(productData, source);
        }
        
        function rejectProductDual(button, name, price, marketValue, reason, source) {
            const productCard = button.closest('[data-product-id]');
            const productId = productCard.getAttribute('data-product-id');
            
            const productData = {
                productId: productId,
                name: name,
                price: price,
                marketValue: marketValue
            };
            
            DUAL_DECISION_SYSTEM.rejectProduct(productData, reason, source);
        }
        
        // Send product to Telegram with inline buttons
        function sendToTelegram(button, name, price, marketValue) {
            const productCard = button.closest('[data-product-id]');
            const productId = productCard.getAttribute('data-product-id');
            
            const profit = marketValue - price;
            const profitPercent = Math.round((profit / price) * 100);
            
            const message = `üéØ <b>PRODUKTENTSCHEIDUNG ERFORDERLICH</b>\n\n` +
                          `üì± ${name}\n` +
                          `üí∞ Preis: ‚Ç¨${price}\n` +
                          `üìà Marktwert: ‚Ç¨${marketValue}\n` +
                          `üéØ Gewinn: ‚Ç¨${profit} (${profitPercent}%)\n\n` +
                          `‚ùì Wie m√∂chten Sie entscheiden?`;
            
            const inlineKeyboard = {
                inline_keyboard: [
                    [
                        {
                            text: "‚úÖ ANNEHMEN",
                            callback_data: `accept_${productId}_${price}_${marketValue}`
                        },
                        {
                            text: "‚ùå ABLEHNEN",
                            callback_data: `reject_${productId}_${price}_${marketValue}`
                        }
                    ],
                    [
                        {
                            text: "üí∞ Zu teuer",
                            callback_data: `reject_${productId}_${price}_${marketValue}_expensive`
                        },
                        {
                            text: "üìç Zu weit weg",
                            callback_data: `reject_${productId}_${price}_${marketValue}_distance`
                        }
                    ],
                    [
                        {
                            text: "üîó Zur Auktion",
                            url: "https://www.zoll-auktion.de"
                        }
                    ]
                ]
            };
            
            sendTelegramMessageWithButtons(message, inlineKeyboard);
            
            // Update button status
            button.textContent = 'üì± Gesendet';
            button.disabled = true;
            button.className = 'px-3 py-1 bg-gray-400 text-white rounded text-xs cursor-not-allowed';
        }
        
        // Manual search function
        function startManualSearch() {
            const button = event.target;
            const originalText = button.textContent;
            
            button.textContent = 'üîç Suche l√§uft...';
            button.disabled = true;
            
            // Perform immediate search
            PRODUCT_SEARCH_SYSTEM.performSearch().then(() => {
                button.textContent = originalText;
                button.disabled = false;
            });
        }
        
        // Update search interval
        function updateSearchInterval() {
            const newInterval = parseInt(document.getElementById('searchInterval').value);
            SEARCH_CONFIG.interval = newInterval;
            
            // Restart search timer with new interval
            PRODUCT_SEARCH_SYSTEM.scheduleNextSearch();
            
            ERROR_LOGGER.logError('config', `Suchintervall ge√§ndert auf ${newInterval} Minuten`, 'info');
            
            const message = `‚öôÔ∏è <b>KONFIGURATION GE√ÑNDERT</b>\n\n` +
                          `‚è∞ Neues Suchintervall: ${newInterval} Minuten\n` +
                          `üîÑ N√§chste Suche wird entsprechend geplant\n` +
                          `üìä Alle anderen Einstellungen bleiben unver√§ndert`;
            
            sendTelegramMessage(message);
        }
        
        // Save search configuration
        function saveSearchConfig() {
            SEARCH_CONFIG.interval = parseInt(document.getElementById('searchInterval').value);
            SEARCH_CONFIG.minProfit = parseInt(document.getElementById('minProfit').value);
            SEARCH_CONFIG.minProfitPercent = parseInt(document.getElementById('minProfitPercent').value);
            SEARCH_CONFIG.autoNotify = document.getElementById('autoNotify').checked;
            SEARCH_CONFIG.errorNotify = document.getElementById('errorNotify').checked;
            
            // Save to localStorage
            localStorage.setItem('searchConfig', JSON.stringify(SEARCH_CONFIG));
            
            // Restart search with new config
            PRODUCT_SEARCH_SYSTEM.scheduleNextSearch();
            
            // Show confirmation
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '‚úÖ Gespeichert!';
            button.style.backgroundColor = '#10b981';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.backgroundColor = '';
            }, 2000);
            
            ERROR_LOGGER.logError('config', 'Such-Konfiguration gespeichert', 'info');
            
            const message = `‚öôÔ∏è <b>KONFIGURATION GESPEICHERT</b>\n\n` +
                          `‚è∞ Suchintervall: ${SEARCH_CONFIG.interval} Minuten\n` +
                          `üí∞ Min. Gewinn: ‚Ç¨${SEARCH_CONFIG.minProfit}\n` +
                          `üìà Min. Gewinn: ${SEARCH_CONFIG.minProfitPercent}%\n` +
                          `üì± Telegram-Benachrichtigungen: ${SEARCH_CONFIG.autoNotify ? 'AN' : 'AUS'}\n` +
                          `üö® Fehler-Benachrichtigungen: ${SEARCH_CONFIG.errorNotify ? 'AN' : 'AUS'}\n\n` +
                          `üîÑ Neue Einstellungen sind sofort aktiv!`;
            
            sendTelegramMessage(message);
        }
        
        // Send Telegram message with inline buttons (with fallback)
        async function sendTelegramMessageWithButtons(message, keyboard) {
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: message,
                        parse_mode: 'HTML',
                        reply_markup: keyboard
                    })
                });
                
                if (response.ok) {
                    console.log('‚úÖ Telegram message with buttons sent successfully');
                    HEALTH_MONITOR.telegram.lastCheck = Date.now();
                    HEALTH_MONITOR.telegram.status = 'online';
                    ERROR_LOGGER.updateHealthUI();
                } else {
                    console.error('‚ùå Failed to send Telegram message with buttons - using fallback');
                    ERROR_LOGGER.logError('telegram', 'Button-Nachricht fehlgeschlagen - verwende Fallback', 'warning');
                    
                    // FALLBACK: Send simple message without buttons
                    const fallbackMessage = message + '\n\n' +
                                          '‚ö†Ô∏è Buttons nicht verf√ºgbar - nutzen Sie die Web-App f√ºr Entscheidungen\n' +
                                          'üíª Alle Produkte sind auch in der Web-App verf√ºgbar';
                    
                    await sendTelegramMessage(fallbackMessage);
                }
            } catch (error) {
                console.error('Error sending Telegram message with buttons:', error);
                ERROR_LOGGER.logError('telegram', `Button-Verbindungsfehler: ${error.message}`, 'error');
                
                // FALLBACK: Send simple notification
                const fallbackMessage = '‚ö†Ô∏è TELEGRAM BUTTON FEHLER\n\n' +
                                      'Neue Produkte gefunden, aber Buttons funktionieren nicht.\n' +
                                      'üíª Bitte nutzen Sie die Web-App f√ºr Entscheidungen.\n' +
                                      'üîÑ Alle Produkte sind dort verf√ºgbar.';
                
                await sendTelegramMessage(fallbackMessage);
            }
        }
        
        // Regular Telegram message function
        async function sendTelegramMessage(message) {
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                
                if (response.ok) {
                    console.log('‚úÖ Telegram message sent successfully');
                    HEALTH_MONITOR.telegram.lastCheck = Date.now();
                    HEALTH_MONITOR.telegram.status = 'online';
                    ERROR_LOGGER.updateHealthUI();
                } else {
                    console.error('‚ùå Failed to send Telegram message');
                    ERROR_LOGGER.logError('telegram', 'Fehler beim Senden der Nachricht', 'error');
                }
            } catch (error) {
                console.error('Error sending Telegram message:', error);
                ERROR_LOGGER.logError('telegram', `Verbindungsfehler: ${error.message}`, 'error');
            }
        }
        
        // Setup Telegram Webhook for receiving button responses
        async function setupTelegramWebhook() {
            const webhookUrl = document.getElementById('webhookUrl').value;
            
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/setWebhook`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        url: webhookUrl
                    })
                });
                
                if (response.ok) {
                    alert('‚úÖ Webhook erfolgreich eingerichtet!\n\nTelegram kann jetzt Inline Button Antworten senden.');
                    sendTelegramMessage('üîó <b>Webhook eingerichtet</b>\n\n‚úÖ Inline Buttons sind jetzt aktiv\nüì± Produktentscheidungen k√∂nnen √ºber Telegram getroffen werden\nüîÑ Automatische Synchronisation zu Google Sheets aktiv');
                    ERROR_LOGGER.logError('telegram', 'Webhook erfolgreich eingerichtet', 'info');
                } else {
                    alert('‚ùå Fehler beim Einrichten des Webhooks');
                    ERROR_LOGGER.logError('telegram', 'Fehler beim Einrichten des Webhooks', 'error');
                }
            } catch (error) {
                console.error('Error setting up webhook:', error);
                alert('‚ùå Fehler beim Einrichten des Webhooks');
                ERROR_LOGGER.logError('telegram', `Webhook-Fehler: ${error.message}`, 'error');
            }
        }
        
        // Test message with buttons
        function sendTestMessageWithButtons() {
            const testMessage = `üß™ <b>TEST-NACHRICHT MIT BUTTONS</b>\n\n` +
                              `üì± iPhone 13 Pro - 256GB (Test)\n` +
                              `üí∞ Preis: ‚Ç¨299\n` +
                              `üìà Marktwert: ‚Ç¨650\n` +
                              `üéØ Gewinn: ‚Ç¨351 (117%)\n\n` +
                              `‚ùì Testen Sie die Inline Buttons:`;
            
            const testKeyboard = {
                inline_keyboard: [
                    [
                        {
                            text: "‚úÖ TEST ANNEHMEN",
                            callback_data: "test_accept_299_650"
                        },
                        {
                            text: "‚ùå TEST ABLEHNEN", 
                            callback_data: "test_reject_299_650"
                        }
                    ],
                    [
                        {
                            text: "üìä Status pr√ºfen",
                            callback_data: "test_status"
                        }
                    ]
                ]
            };
            
            sendTelegramMessageWithButtons(testMessage, testKeyboard);
        }
        
        // Emergency mode - disable all Telegram buttons and use only Web-App
        function enableEmergencyMode() {
            // Disable buttons
            document.getElementById('inlineButtons').checked = false;
            
            // Update configuration
            SEARCH_CONFIG.autoNotify = true; // Keep notifications but without buttons
            
            // Show confirmation
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '‚úÖ Notfall-Modus aktiv!';
            button.style.backgroundColor = '#dc2626';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.backgroundColor = '';
            }, 3000);
            
            // Send notification
            const emergencyMessage = `üö® <b>NOTFALL-MODUS AKTIVIERT</b>\n\n` +
                                   `‚ùå Telegram Buttons deaktiviert\n` +
                                   `üíª Alle Entscheidungen nur √ºber Web-App\n` +
                                   `üì± Telegram sendet nur Benachrichtigungen\n` +
                                   `üîÑ Vollst√§ndige Synchronisation bleibt aktiv\n` +
                                   `üìä Google Sheets Integration funktioniert weiter\n\n` +
                                   `‚úÖ System l√§uft stabil im Notfall-Modus!\n` +
                                   `üéØ Alle 30 Produkte werden weiterhin gefunden\n` +
                                   `üíª √ñffnen Sie das Dashboard f√ºr Entscheidungen`;
            
            sendTelegramMessage(emergencyMessage);
            
            ERROR_LOGGER.logError('system', 'Notfall-Modus aktiviert - nur Web-App Entscheidungen', 'warning');
            
            alert('üö® NOTFALL-MODUS AKTIVIERT!\n\n' +
                  '‚úÖ Telegram Buttons deaktiviert\n' +
                  'üíª Alle Entscheidungen √ºber Web-App\n' +
                  'üì± Telegram sendet nur Benachrichtigungen\n' +
                  'üîÑ Vollst√§ndige Synchronisation bleibt aktiv\n\n' +
                  'Das System l√§uft jetzt stabil ohne Button-Probleme!');
        }
        
        // Enhanced Telegram callback handling with auto-removal
        function simulateTelegramCallback(callbackData, messageId = null) {
            console.log('Simulating Telegram callback:', callbackData);
            
            const parts = callbackData.split('_');
            const action = parts[0];
            const productId = parts[1];
            const price = parseInt(parts[2]);
            const marketValue = parseInt(parts[3]);
            const productNameEncoded = parts[4] || '';
            
            // Find product name from current products or use encoded name
            const productElements = document.querySelectorAll('[data-product-id]');
            let productName = 'Telegram Produkt';
            let maxRejections = 1;
            
            productElements.forEach(element => {
                if (element.getAttribute('data-product-id') === productId) {
                    const nameElement = element.querySelector('h4');
                    if (nameElement) {
                        productName = nameElement.textContent;
                    }
                }
            });
            
            // Calculate max rejections based on profit
            const profitPercent = ((marketValue - price) / price) * 100;
            if (profitPercent > 150) {
                maxRejections = 3;
            } else if (profitPercent > 100) {
                maxRejections = 2;
            } else {
                maxRejections = 1;
            }
            
            const productData = {
                productId: productId,
                name: productName,
                price: price,
                marketValue: marketValue,
                maxRejections: maxRejections
            };
            
            if (action === 'accept') {
                DUAL_DECISION_SYSTEM.acceptProduct(productData, 'TELEGRAM');
                
                // Send confirmation and remove from Telegram
                if (messageId) {
                    const confirmMessage = `‚úÖ <b>PRODUKT ANGENOMMEN</b>\n\n` +
                                         `üì± ${productName}\n` +
                                         `üí∞ Preis: ‚Ç¨${price}\n` +
                                         `üìà Gewinn: ‚Ç¨${marketValue - price}\n\n` +
                                         `üéØ Entscheidung via Telegram gespeichert\n` +
                                         `üìä Automatisch zu Google Sheets √ºbertragen\n` +
                                         `üîÑ Aus beiden Systemen entfernt`;
                    
                    // Edit original message to show decision
                    editTelegramMessage(messageId, confirmMessage);
                }
                
            } else if (action === 'reject') {
                DUAL_DECISION_SYSTEM.rejectProduct(productData, 'Via Telegram abgelehnt', 'TELEGRAM');
                
                // The rejection confirmation is handled by the DUAL_DECISION_SYSTEM
                // which will send appropriate messages based on whether it will show again
            }
        }
        
        // Edit Telegram message (simulated)
        async function editTelegramMessage(messageId, newText) {
            try {
                // In real implementation, this would edit the original message
                console.log(`Editing Telegram message ${messageId}:`, newText);
                
                // Simulate API call
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/editMessageText`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        message_id: messageId,
                        text: newText,
                        parse_mode: 'HTML'
                    })
                });
                
                if (response.ok) {
                    console.log('‚úÖ Telegram message edited successfully');
                } else {
                    console.error('‚ùå Failed to edit Telegram message');
                }
            } catch (error) {
                console.error('Error editing Telegram message:', error);
            }
        }
        
        // Webhook endpoint simulation (in real app, this would be server-side)
        function handleTelegramWebhook(update) {
            if (update.callback_query) {
                const callbackData = update.callback_query.data;
                const chatId = update.callback_query.message.chat.id;
                
                // Process the callback
                simulateTelegramCallback(callbackData);
                
                // Send acknowledgment back to Telegram
                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/answerCallbackQuery`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        callback_query_id: update.callback_query.id,
                        text: "Entscheidung verarbeitet ‚úÖ"
                    })
                });
            }
        }
        
        // Google Sheets functions
        function openGoogleSheets() {
            const sheetId = document.getElementById('spreadsheetId').value;
            window.open(`https://docs.google.com/spreadsheets/d/${sheetId}/edit`, '_blank');
        }
        
        function syncAllToSheets() {
            const decisions = JSON.parse(localStorage.getItem('allDecisions') || '[]');
            
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Synchronisiere...';
            button.disabled = true;
            
            // Simulate sync process
            setTimeout(() => {
                button.textContent = 'Sync abgeschlossen ‚úÖ';
                button.style.backgroundColor = '#10b981';
                
                const syncMsg = `üîÑ <b>Google Sheets Synchronisation</b>\n\n` +
                              `üìä ${decisions.length} Entscheidungen synchronisiert\n` +
                              `‚úÖ Angenommene ‚Üí Spalten A-P (gr√ºn)\n` +
                              `‚ùå Abgelehnte ‚Üí Spalten Q-AF (rot)\n` +
                              `üì± Telegram ‚Üí blau markiert\n` +
                              `üíª Web-App ‚Üí lila markiert\n\n` +
                              `‚è∞ ${new Date().toLocaleString('de-DE')}`;
                
                sendTelegramMessage(syncMsg);
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.backgroundColor = '';
                    button.disabled = false;
                }, 3000);
            }, 2000);
        }
        
        // Health check system
        function startHealthCheck() {
            healthCheckTimer = setInterval(() => {
                // Check each component
                checkTelegramHealth();
                checkWebAppHealth();
                checkSheetsHealth();
                checkSearchHealth();
                
                // Update last check times
                document.getElementById('lastCheckTime').textContent = 
                    `Letzte Pr√ºfung: ${new Date().toLocaleTimeString('de-DE')}`;
                
            }, 30000); // Check every 30 seconds
        }
        
        function checkTelegramHealth() {
            // Simulate health check
            const timeSinceLastCheck = Date.now() - HEALTH_MONITOR.telegram.lastCheck;
            
            if (timeSinceLastCheck > 5 * 60 * 1000) { // 5 minutes
                ERROR_LOGGER.logError('telegram', 'Keine Aktivit√§t seit 5 Minuten', 'warning');
            }
        }
        
        function checkWebAppHealth() {
            // Web app is always healthy if this code is running
            HEALTH_MONITOR.webapp.lastCheck = Date.now();
            HEALTH_MONITOR.webapp.status = 'online';
        }
        
        function checkSheetsHealth() {
            // Simulate sheets health check
            const timeSinceLastCheck = Date.now() - HEALTH_MONITOR.sheets.lastCheck;
            
            if (timeSinceLastCheck > 10 * 60 * 1000) { // 10 minutes
                ERROR_LOGGER.logError('sheets', 'Keine Synchronisation seit 10 Minuten', 'warning');
            }
        }
        
        function checkSearchHealth() {
            // Check if search is running properly
            if (PRODUCT_SEARCH_SYSTEM.isSearching && Date.now() - HEALTH_MONITOR.search.lastCheck > 2 * 60 * 1000) {
                ERROR_LOGGER.logError('search', 'Suche l√§uft zu lange (>2 Min)', 'warning');
            }
        }
        
        // Login functionality
        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            if (input === PASSWORD) {
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('errorMsg').classList.add('hidden');
                initializeApp();
            } else {
                document.getElementById('errorMsg').classList.remove('hidden');
                document.getElementById('passwordInput').value = '';
            }
        }
        
        // Initialize app
        function initializeApp() {
            // Load saved configuration
            const savedConfig = localStorage.getItem('searchConfig');
            if (savedConfig) {
                SEARCH_CONFIG = { ...SEARCH_CONFIG, ...JSON.parse(savedConfig) };
                
                // Update UI with saved config
                document.getElementById('searchInterval').value = SEARCH_CONFIG.interval;
                document.getElementById('minProfit').value = SEARCH_CONFIG.minProfit;
                document.getElementById('minProfitPercent').value = SEARCH_CONFIG.minProfitPercent;
                document.getElementById('autoNotify').checked = SEARCH_CONFIG.autoNotify;
                document.getElementById('errorNotify').checked = SEARCH_CONFIG.errorNotify;
            }
            
            // Update statistics
            DUAL_DECISION_SYSTEM.updateStatistics();
            
            // Initialize Google Sheets link
            DUAL_DECISION_SYSTEM.updateGoogleSheetsLink();
            
            // Start automatic search
            PRODUCT_SEARCH_SYSTEM.startAutoSearch();
            
            // Start health monitoring
            startHealthCheck();
            
            // Update health UI
            ERROR_LOGGER.updateHealthUI();
            
            // Send startup notification
            sendTelegramMessage('üöÄ <b>AUKTIONS-BOT PERFEKT OPTIMIERT!</b>\n\n' +
                              '‚úÖ Dashboard erfolgreich geladen\n' +
                              '‚è∞ Deep Scraping: 30 Produkte alle 15 Min\n' +
                              `üîç Suchintervall: ${SEARCH_CONFIG.interval} Minuten\n` +
                              'üì± Telegram: Nur Benachrichtigungen (keine Buttons)\n' +
                              'üîÑ Intelligente Duplikatserkennung aktiv\n' +
                              'üíª Alle Entscheidungen √ºber Web-App\n' +
                              'üìä Google Sheets Auto-Sync eingerichtet\n' +
                              'üîó Direkter Google Sheets Link verf√ºgbar\n' +
                              'üè• System-Gesundheits√ºberwachung aktiv\n' +
                              'üö® Fehlerbenachrichtigungen aktiviert\n' +
                              'üéØ Keine Duplikate mehr!\n' +
                              'üöÄ Bereit f√ºr 24/7 Betrieb!\n\n' +
                              'üí° F√ºr 24/7 Hosting-Anleitung: Button im Dashboard klicken!');
        }
        
        // Allow Enter key for login
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });
            
            // Show login modal
            document.getElementById('loginModal').style.display = 'flex';
        });
        
        // Test functions for demonstration
        function testTelegramDecision() {
            // Simulate a Telegram decision
            simulateTelegramCallback('accept_PROD004_199_450');
        }
        
        function testWebAppDecision() {
            // Simulate a Web-App decision
            const productData = {
                productId: 'PROD005',
                name: 'Test Produkt (Web-App)',
                price: 150,
                marketValue: 300,
                reason: 'Test √ºber Web-App'
            };
            
            DUAL_DECISION_SYSTEM.acceptProduct(productData, 'WEB-APP');
        }
        
        function testErrorSystem() {
            // Test different error types
            ERROR_LOGGER.logError('telegram', 'Test-Warnung f√ºr Telegram', 'warning');
            ERROR_LOGGER.logError('search', 'Test-Fehler f√ºr Produktsuche', 'error');
            ERROR_LOGGER.logError('sheets', 'Test-kritischer Fehler f√ºr Google Sheets', 'critical');
        }
        
        // Add test buttons to console for demonstration
        console.log('üß™ Test Functions Available:');
        console.log('- testTelegramDecision() - Simuliert Telegram Entscheidung');
        console.log('- testWebAppDecision() - Simuliert Web-App Entscheidung');
        console.log('- testErrorSystem() - Testet Fehlerbenachrichtigungen');
        console.log('- PRODUCT_SEARCH_SYSTEM.performSearch() - Startet manuelle Suche');
        console.log('- DUAL_DECISION_SYSTEM - Vollst√§ndiges Entscheidungssystem');
        console.log('- ERROR_LOGGER - Fehlerprotokollierung und Benachrichtigungen');
        console.log('- simulateTelegramCallback("accept_PROD123_299_650", 12345) - Telegram Annahme');
        console.log('- simulateTelegramCallback("reject_PROD123_299_650_expensive", 12345) - Telegram Ablehnung');
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c25c7387b51c0f',t:'MTc1NDY5MTIwOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
